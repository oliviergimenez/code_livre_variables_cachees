<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Survival Analysis in R</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/paper.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 64px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h2 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h3 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h4 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h5 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h6 {
  padding-top: 69px;
  margin-top: -69px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Tutorials</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="http://www.emilyzabor.com">by Emily C. Zabor</a>
</li>
<li>
  <a href="http://github.com/zabore/tutorials">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Survival Analysis in R</h1>

</div>


<p>This tutorial provides an introduction to survival analysis, and to conducting a survival analysis in R.</p>
<p>This tutorial was originally presented at the Memorial Sloan Kettering Cancer Center R-Presenters series on August 30, 2018.</p>
<p>It was then modified for a more extensive training at Memorial Sloan Kettering Cancer Center in March, 2019.</p>
<p>Please click the GitHub icon in the header above to go to the GitHub repository for this tutorial, where all of the source code for this tutorial can be accessed in the file <code>survival_analysis_in_r.Rmd</code>.</p>
<div id="part-1-introduction-to-survival-analysis" class="section level1">
<h1>Part 1: Introduction to Survival Analysis</h1>
<p>This presentation will cover some basics of survival analysis, and the following series tutorial papers can be helpful for additional reading:</p>
<blockquote>
<p>Clark, T., Bradburn, M., Love, S., &amp; Altman, D. (2003). Survival analysis part I: Basic concepts and first analyses. 232-238. ISSN 0007-0920.</p>
</blockquote>
<blockquote>
<p>M J Bradburn, T G Clark, S B Love, &amp; D G Altman. (2003). Survival Analysis Part II: Multivariate data analysis – an introduction to concepts and methods. British Journal of Cancer, 89(3), 431-436.</p>
</blockquote>
<blockquote>
<p>Bradburn, M., Clark, T., Love, S., &amp; Altman, D. (2003). Survival analysis Part III: Multivariate data analysis – choosing a model and assessing its adequacy and fit. 89(4), 605-11.</p>
</blockquote>
<blockquote>
<p>Clark, T., Bradburn, M., Love, S., &amp; Altman, D. (2003). Survival analysis part IV: Further concepts and methods in survival analysis. 781-786. ISSN 0007-0920.</p>
</blockquote>
<div id="packages" class="section level2">
<h2>Packages</h2>
<p>Some packages we’ll be using today include:</p>
<ul>
<li><code>lubridate</code></li>
<li><code>survival</code></li>
<li><code>survminer</code></li>
</ul>
<pre class="r"><code>library(survival)
library(survminer)
library(lubridate)</code></pre>
</div>
<div id="what-is-survival-data" class="section level2">
<h2>What is survival data?</h2>
<p>Time-to-event data that consist of a distinct start time and end time.</p>
<p>Examples from cancer</p>
<ul>
<li>Time from surgery to death</li>
<li>Time from start of treatment to progression</li>
<li>Time from response to recurrence</li>
</ul>
</div>
<div id="examples-from-other-fields" class="section level2">
<h2>Examples from other fields</h2>
<p>Time-to-event data are common in many fields including, but not limited to</p>
<ul>
<li>Time from HIV infection to development of AIDS</li>
<li>Time to heart attack</li>
<li>Time to onset of substance abuse</li>
<li>Time to initiation of sexual activity</li>
<li>Time to machine malfunction</li>
</ul>
</div>
<div id="aliases-for-survival-analysis" class="section level2">
<h2>Aliases for survival analysis</h2>
<p>Because survival analysis is common in many other fields, it also goes by other names</p>
<ul>
<li>Reliability analysis</li>
<li>Duration analysis</li>
<li>Event history analysis</li>
<li>Time-to-event analysis</li>
</ul>
</div>
<div id="the-lung-dataset" class="section level2">
<h2>The lung dataset</h2>
<p>The <code>lung</code> dataset is available from the <code>survival</code> package in <code>R</code>. The data contain subjects with advanced lung cancer from the North Central Cancer Treatment Group. Some variables we will use to demonstrate methods today include</p>
<ul>
<li>time: Survival time in days</li>
<li>status: censoring status 1=censored, 2=dead</li>
<li>sex: Male=1 Female=2</li>
</ul>
</div>
<div id="what-is-censoring" class="section level2">
<h2>What is censoring?</h2>
<p><img src="img/trial_anatomy.png" /><!-- --></p>
<blockquote>
<p>RICH JT, NEELY JG, PANIELLO RC, VOELKER CCJ, NUSSENBAUM B, WANG EW. A PRACTICAL GUIDE TO UNDERSTANDING KAPLAN-MEIER CURVES. Otolaryngology head and neck surgery: official journal of American Academy of Otolaryngology Head and Neck Surgery. 2010;143(3):331-336. <a href="doi:10.1016/j.otohns.2010.05.007" class="uri">doi:10.1016/j.otohns.2010.05.007</a>.</p>
</blockquote>
</div>
<div id="types-of-censoring" class="section level2">
<h2>Types of censoring</h2>
<p>A subject may be censored due to:</p>
<ul>
<li>Loss to follow-up</li>
<li>Withdrawal from study</li>
<li>No event by end of fixed study period</li>
</ul>
<p>Specifically these are examples of <strong>right</strong> censoring.</p>
<p>Left censoring and interval censoring are also possible, and methods exist to analyze this type of data, but this training will be limited to right censoring.</p>
</div>
<div id="censored-survival-data" class="section level2">
<h2>Censored survival data</h2>
<p><img src="survival_analysis_in_r_tutorial_files/figure-html/swimmer-1.png" width="480" /></p>
<p>In this example, how would we compute the proportion who are event-free at 10 years?</p>
<p>Subjects 6 and 7 were <strong>event-free at 10 years</strong>. Subjects 2, 9, and 10 had the <strong>event before 10 years</strong>. Subjects 1, 3, 4, 5, and 8 were <strong>censored before 10 years</strong>, so we don’t know whether they had the event or not by 10 years - how do we incorporate these subjects into our estimate?</p>
</div>
<div id="distribution-of-follow-up-time" class="section level2">
<h2>Distribution of follow-up time</h2>
<ul>
<li>Censored subjects still provide information so must be appropriately included in the analysis</li>
<li>Distribution of follow-up times is skewed, and may differ between censored patients and those with events</li>
<li>Follow-up times are always positive</li>
</ul>
<p><img src="survival_analysis_in_r_tutorial_files/figure-html/fuptimes-1.png" width="480" /></p>
</div>
<div id="components-of-survival-data" class="section level2">
<h2>Components of survival data</h2>
<p>For subject <span class="math inline">\(i\)</span>:</p>
<ol style="list-style-type: decimal">
<li><p>Event time <span class="math inline">\(T_i\)</span></p></li>
<li><p>Censoring time <span class="math inline">\(C_i\)</span></p></li>
<li><p>Event indicator <span class="math inline">\(\delta_i\)</span>:</p>
<ul>
<li>1 if event observed (i.e. <span class="math inline">\(T_i \leq C_i\)</span>)</li>
<li>0 if censored (i.e. <span class="math inline">\(T_i &gt; C_i\)</span>)</li>
</ul></li>
<li><p>Observed time <span class="math inline">\(Y_i = \min(T_i, C_i)\)</span></p></li>
</ol>
<p>The observed times and an event indicator are provided in the <code>lung</code> data</p>
<ul>
<li>time: Survival time in days (<span class="math inline">\(Y_i\)</span>)</li>
<li>status: censoring status 1=censored, 2=dead (<span class="math inline">\(\delta_i\)</span>)</li>
</ul>
<table>
<thead>
<tr class="header">
<th align="right">inst</th>
<th align="right">time</th>
<th align="right">status</th>
<th align="right">age</th>
<th align="right">sex</th>
<th align="right">ph.ecog</th>
<th align="right">ph.karno</th>
<th align="right">pat.karno</th>
<th align="right">meal.cal</th>
<th align="right">wt.loss</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">3</td>
<td align="right">306</td>
<td align="right">2</td>
<td align="right">74</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">90</td>
<td align="right">100</td>
<td align="right">1175</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">455</td>
<td align="right">2</td>
<td align="right">68</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">90</td>
<td align="right">90</td>
<td align="right">1225</td>
<td align="right">15</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">1010</td>
<td align="right">1</td>
<td align="right">56</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">90</td>
<td align="right">90</td>
<td align="right">NA</td>
<td align="right">15</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="right">210</td>
<td align="right">2</td>
<td align="right">57</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">90</td>
<td align="right">60</td>
<td align="right">1150</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">883</td>
<td align="right">2</td>
<td align="right">60</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">100</td>
<td align="right">90</td>
<td align="right">NA</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">12</td>
<td align="right">1022</td>
<td align="right">1</td>
<td align="right">74</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">50</td>
<td align="right">80</td>
<td align="right">513</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
<div id="dealing-with-dates-in-r" class="section level2">
<h2>Dealing with dates in R</h2>
<p>Data will often come with start and end dates rather than pre-calculated survival times. The first step is to make sure these are formatted as dates in R.</p>
<p>Let’s create a small example dataset with variables <code>sx_date</code> for surgery date and <code>last_fup_date</code> for the last follow-up date.</p>
<pre class="r"><code>date_ex &lt;- 
  tibble(
    sx_date = c(&quot;2007-06-22&quot;, &quot;2004-02-13&quot;, &quot;2010-10-27&quot;), 
    last_fup_date = c(&quot;2017-04-15&quot;, &quot;2018-07-04&quot;, &quot;2016-10-31&quot;)
    )

date_ex</code></pre>
<pre><code>## # A tibble: 3 x 2
##   sx_date    last_fup_date
##   &lt;chr&gt;      &lt;chr&gt;        
## 1 2007-06-22 2017-04-15   
## 2 2004-02-13 2018-07-04   
## 3 2010-10-27 2016-10-31</code></pre>
<p>We see these are both character variables, which will often be the case, but we need them to be formatted as dates.</p>
</div>
<div id="formatting-dates---base-r" class="section level2">
<h2>Formatting dates - base R</h2>
<pre class="r"><code>date_ex %&gt;% 
  mutate(
    sx_date = as.Date(sx_date, format = &quot;%Y-%m-%d&quot;), 
    last_fup_date = as.Date(last_fup_date, format = &quot;%Y-%m-%d&quot;) 
    )</code></pre>
<pre><code>## # A tibble: 3 x 2
##   sx_date    last_fup_date
##   &lt;date&gt;     &lt;date&gt;       
## 1 2007-06-22 2017-04-15   
## 2 2004-02-13 2018-07-04   
## 3 2010-10-27 2016-10-31</code></pre>
<ul>
<li>Note that in base <code>R</code> the format must include the separator as well as the symbol. e.g. if your date is in format m/d/Y then you would need <code>format = "%m/%d/%Y"</code></li>
<li>See a full list of date format symbols at <a href="https://www.statmethods.net/input/dates.html">https://www.statmethods.net/input/dates.html</a></li>
</ul>
</div>
<div id="formatting-dates---lubridate-package" class="section level2">
<h2>Formatting dates - lubridate package</h2>
<p>We can also use the <code>lubridate</code> package to format dates. In this case, use the <code>ymd</code> function</p>
<pre class="r"><code>date_ex %&gt;% 
  mutate(
    sx_date = ymd(sx_date), 
    last_fup_date = ymd(last_fup_date)
    )</code></pre>
<pre><code>## # A tibble: 3 x 2
##   sx_date    last_fup_date
##   &lt;date&gt;     &lt;date&gt;       
## 1 2007-06-22 2017-04-15   
## 2 2004-02-13 2018-07-04   
## 3 2010-10-27 2016-10-31</code></pre>
<ul>
<li>Note that unlike the base <code>R</code> option, the separators do not need to be specified</li>
<li>The help page for <code>?dmy</code> will show all format options.</li>
</ul>
</div>
<div id="calculating-survival-times---base-r" class="section level2">
<h2>Calculating survival times - base R</h2>
<p>Now that the dates formatted, we need to calculate the difference between start and end time in some units, usually months or years. In base <code>R</code>, use <code>difftime</code> to calculate the number of days between our two dates and convert it to a numeric value using <code>as.numeric</code>. Then convert to years by dividing by <code>365.25</code>, the average number of days in a year.</p>
<pre class="r"><code>date_ex %&gt;% 
  mutate(
    os_yrs = 
      as.numeric(
        difftime(last_fup_date, 
                 sx_date, 
                 units = &quot;days&quot;)) / 365.25
    )</code></pre>
<pre><code>## # A tibble: 3 x 3
##   sx_date    last_fup_date os_yrs
##   &lt;date&gt;     &lt;date&gt;         &lt;dbl&gt;
## 1 2007-06-22 2017-04-15      9.82
## 2 2004-02-13 2018-07-04     14.4 
## 3 2010-10-27 2016-10-31      6.01</code></pre>
</div>
<div id="calculating-survival-times---lubridate" class="section level2">
<h2>Calculating survival times - lubridate</h2>
<p>Using the <code>lubridate</code> package, the operator <code>%--%</code> designates a time interval, which is then converted to the number of elapsed seconds using <code>as.duration</code> and finally converted to years by dividing by <code>dyears(1)</code>, which gives the number of seconds in a year.</p>
<pre class="r"><code>date_ex %&gt;% 
  mutate(
    os_yrs = 
      as.duration(sx_date %--% last_fup_date) / dyears(1)
    )</code></pre>
<pre><code>## # A tibble: 3 x 3
##   sx_date    last_fup_date os_yrs
##   &lt;date&gt;     &lt;date&gt;         &lt;dbl&gt;
## 1 2007-06-22 2017-04-15      9.82
## 2 2004-02-13 2018-07-04     14.4 
## 3 2010-10-27 2016-10-31      6.02</code></pre>
<ul>
<li><em>Note</em>: we need to load the <code>lubridate</code> package using a call to <code>library</code> in order to be able to access the special operators (similar to situation with pipes)</li>
</ul>
</div>
<div id="event-indicator" class="section level2">
<h2>Event indicator</h2>
<p>For the components of survival data I mentioned the event indicator:</p>
<p>Event indicator <span class="math inline">\(\delta_i\)</span>:</p>
<ul>
<li>1 if event observed (i.e. <span class="math inline">\(T_i \leq C_i\)</span>)</li>
<li>0 if censored (i.e. <span class="math inline">\(T_i &gt; C_i\)</span>)</li>
</ul>
<p>However, in <code>R</code> the <code>Surv</code> function will also accept TRUE/FALSE (TRUE = event) or 1/2 (2 = event).</p>
<p>In the <code>lung</code> data, we have:</p>
<ul>
<li>status: censoring status 1=censored, 2=dead</li>
</ul>
</div>
<div id="survival-function" class="section level2">
<h2>Survival function</h2>
<p>The probability that a subject will survive beyond any given specified time</p>
<p><span class="math display">\[S(t) = Pr(T&gt;t) = 1 - F(t)\]</span></p>
<p><span class="math inline">\(S(t)\)</span>: survival function <span class="math inline">\(F(t) = Pr(T \leq t)\)</span>: cumulative distribution function</p>
<p>In theory the survival function is smooth; in practice we observe events on a discrete time scale.</p>
</div>
<div id="survival-probability" class="section level2">
<h2>Survival probability</h2>
<ul>
<li><strong>Survival probability</strong> at a certain time, <span class="math inline">\(S(t)\)</span>, is a conditional probability of surviving beyond that time, given that an individual has survived just prior to that time.</li>
<li>Can be estimated as the number of patients who are alive without loss to follow-up at that time, divided by the number of patients who were alive just prior to that time</li>
<li>The <strong>Kaplan-Meier</strong> estimate of survival probability is the product of these conditional probabilities up until that time</li>
<li>At time 0, the survival probability is 1, i.e. <span class="math inline">\(S(t_0) = 1\)</span></li>
</ul>
</div>
<div id="creating-survival-objects" class="section level2">
<h2>Creating survival objects</h2>
<p>The Kaplan-Meier method is the most common way to estimate survival times and probabilities. It is a non-parametric approach that results in a step function, where there is a step down each time an event occurs.</p>
<ul>
<li>The <code>Surv</code> function from the <code>survival</code> package creates a survival object for use as the response in a model formula. There will be one entry for each subject that is the survival time, which is followed by a <code>+</code> if the subject was censored. Let’s look at the first 10 observations:</li>
</ul>
<pre class="r"><code>Surv(lung$time, lung$status)[1:10]</code></pre>
<pre><code>##  [1]  306   455  1010+  210   883  1022+  310   361   218   166</code></pre>
</div>
<div id="estimating-survival-curves-with-the-kaplan-meier-method" class="section level2">
<h2>Estimating survival curves with the Kaplan-Meier method</h2>
<ul>
<li>The <code>survfit</code> function creates survival curves based on a formula. Let’s generate the overall survival curve for the entire cohort, assign it to object <code>f1</code>, and look at the <code>names</code> of that object:</li>
</ul>
<pre class="r"><code>f1 &lt;- survfit(Surv(time, status) ~ 1, data = lung)
names(f1)</code></pre>
<pre><code>##  [1] &quot;n&quot;         &quot;time&quot;      &quot;n.risk&quot;    &quot;n.event&quot;   &quot;n.censor&quot;  &quot;surv&quot;     
##  [7] &quot;std.err&quot;   &quot;cumhaz&quot;    &quot;std.chaz&quot;  &quot;type&quot;      &quot;logse&quot;     &quot;conf.int&quot; 
## [13] &quot;conf.type&quot; &quot;lower&quot;     &quot;upper&quot;     &quot;call&quot;</code></pre>
<p>Some key components of this <code>survfit</code> object that will be used to create survival curves include:</p>
<ul>
<li><code>time</code>, which contains the start and endpoints of each time interval</li>
<li><code>surv</code>, which contains the survival probability corresponding to each <code>time</code></li>
</ul>
</div>
<div id="kaplan-meier-plot---base-r" class="section level2">
<h2>Kaplan-Meier plot - base R</h2>
<p>Now we plot the <code>survfit</code> object in base <code>R</code> to get the Kaplan-Meier plot.</p>
<pre class="r"><code>plot(survfit(Surv(time, status) ~ 1, data = lung), 
     xlab = &quot;Days&quot;, 
     ylab = &quot;Overall survival probability&quot;)</code></pre>
<p><img src="survival_analysis_in_r_tutorial_files/figure-html/unnamed-chunk-2-1.png" width="480" /></p>
<ul>
<li>The default plot in base <code>R</code> shows the step function (solid line) with associated confidence intervals (dotted lines)</li>
<li>Horizontal lines represent survival duration for the interval</li>
<li>An interval is terminated by an event</li>
<li>The height of vertical lines show the change in cumulative probability</li>
<li>Censored observations, indicated by tick marks, reduce the cumulative survival between intervals. (<em>Note</em> the tick marks for censored patients are not shown by default, but could be added using the option <code>mark.time = TRUE</code>)</li>
</ul>
</div>
<div id="kaplan-meier-plot---ggsurvplot" class="section level2">
<h2>Kaplan-Meier plot - ggsurvplot</h2>
<p>Alternatively, the <code>ggsurvplot</code> function from the <code>survminer</code> package is built on <code>ggplot2</code>, and can be used to create Kaplan-Meier plots. Checkout the <a href="https://rpkgs.datanovia.com/survminer/survminer_cheatsheet.pdf">cheatsheet</a> for the <code>survminer</code> package.</p>
<pre class="r"><code>ggsurvplot(
    fit = survfit(Surv(time, status) ~ 1, data = lung), 
    xlab = &quot;Days&quot;, 
    ylab = &quot;Overall survival probability&quot;)</code></pre>
<p><img src="survival_analysis_in_r_tutorial_files/figure-html/unnamed-chunk-3-1.png" width="480" /></p>
<ul>
<li>The default plot using <code>ggsurvplot</code> shows the step function (solid line) with associated confidence bands (shaded area).</li>
<li>The tick marks for censored patients are shown by default, somewhat obscuring the line itself in this example, and could be supressed using the option <code>censor = FALSE</code></li>
</ul>
</div>
<div id="estimating-x-year-survival" class="section level2">
<h2>Estimating <span class="math inline">\(x\)</span>-year survival</h2>
<p>One quantity often of interest in a survival analysis is the probability of surviving beyond a certain number (<span class="math inline">\(x\)</span>) of years.</p>
<p>For example, to estimate the probability of survivng to <span class="math inline">\(1\)</span> year, use <code>summary</code> with the <code>times</code> argument (<em>Note</em> the <code>time</code> variable in the <code>lung</code> data is actually in days, so we need to use <code>times = 365.25</code>)</p>
<pre class="r"><code>summary(survfit(Surv(time, status) ~ 1, data = lung), times = 365.25)</code></pre>
<pre><code>## Call: survfit(formula = Surv(time, status) ~ 1, data = lung)
## 
##  time n.risk n.event survival std.err lower 95% CI upper 95% CI
##   365     65     121    0.409  0.0358        0.345        0.486</code></pre>
<p>We find that the <span class="math inline">\(1\)</span>-year probability of survival in this study is 41%.</p>
<p>The associated lower and upper bounds of the 95% confidence interval are also displayed.</p>
</div>
<div id="x-year-survival-and-the-survival-curve" class="section level2">
<h2><span class="math inline">\(x\)</span>-year survival and the survival curve</h2>
<p>The <span class="math inline">\(1\)</span>-year survival probability is the point on the y-axis that corresponds to <span class="math inline">\(1\)</span> year on the x-axis for the survival curve.</p>
<p><img src="survival_analysis_in_r_tutorial_files/figure-html/unnamed-chunk-4-1.png" width="480" /></p>
</div>
<div id="x-year-survival-is-often-estimated-incorrectly" class="section level2">
<h2><span class="math inline">\(x\)</span>-year survival is often estimated incorrectly</h2>
<p>What happens if you use a “naive” estimate?</p>
<p>121 of the 228 patients died by <span class="math inline">\(1\)</span> year so:</p>
<p><span class="math display">\[\Big(1 - \frac{121}{228}\Big) \times 100 = 47\%\]</span> - You get an <strong>incorrect</strong> estimate of the <span class="math inline">\(1\)</span>-year probability of survival when you ignore the fact that 42 patients were censored before <span class="math inline">\(1\)</span> year.</p>
<ul>
<li>Recall the <strong>correct</strong> estimate of the <span class="math inline">\(1\)</span>-year probability of survival was 41%.</li>
</ul>
</div>
<div id="impact-on-x-year-survival-of-ignoring-censoring" class="section level2">
<h2>Impact on <span class="math inline">\(x\)</span>-year survival of ignoring censoring</h2>
<ul>
<li>Imagine two studies, each with 228 subjects. There are 165 deaths in each study. No censoring in one (orange line), 63 patients censored in the other (blue line)</li>
<li>Ignoring censoring leads to an <strong>overestimate</strong> of the overall survival probability, because the censored subjects only contribute information for <strong>part</strong> of the follow-up time, and then fall out of the risk set, thus pulling down the cumulative probability of survival</li>
</ul>
<p><img src="survival_analysis_in_r_tutorial_files/figure-html/unnamed-chunk-5-1.png" width="480" /></p>
</div>
<div id="estimating-median-survival-time" class="section level2">
<h2>Estimating median survival time</h2>
<p>Another quantity often of interest in a survival analysis is the average survival time, which we quantify using the median. Survival times are not expected to be normally distributed so the mean is not an appropriate summary.</p>
<p>We can obtain this directly from our <code>survfit</code> object</p>
<pre class="r"><code>survfit(Surv(time, status) ~ 1, data = lung)</code></pre>
<pre><code>## Call: survfit(formula = Surv(time, status) ~ 1, data = lung)
## 
##       n  events  median 0.95LCL 0.95UCL 
##     228     165     310     285     363</code></pre>
<p>We see the median survival time is 310 days The lower and upper bounds of the 95% confidence interval are also displayed.</p>
</div>
<div id="median-survival-time-and-the-survival-curve" class="section level2">
<h2>Median survival time and the survival curve</h2>
<p>Median survival is the time corresponding to a survival probability of <span class="math inline">\(0.5\)</span>:</p>
<p><img src="survival_analysis_in_r_tutorial_files/figure-html/unnamed-chunk-7-1.png" width="480" /></p>
</div>
<div id="median-survival-is-often-estimated-incorrectly" class="section level2">
<h2>Median survival is often estimated incorrectly</h2>
<p>What happens if you use a “naive” estimate?</p>
<p>Summarize the median survival time among the 165 patients who died</p>
<pre class="r"><code>lung %&gt;% 
  filter(status == 2) %&gt;% 
  summarize(median_surv = median(time))</code></pre>
<pre><code>##   median_surv
## 1         226</code></pre>
<ul>
<li>You get an <strong>incorrect</strong> estimate of median survival time of 226 days when you ignore the fact that censored patients also contribute follow-up time.</li>
<li>Recall the <strong>correct</strong> estimate of median survival time is 310 days.</li>
</ul>
</div>
<div id="impact-on-median-survival-of-ignoring-censoring" class="section level2">
<h2>Impact on median survival of ignoring censoring</h2>
<ul>
<li>Ignoring censoring creates an artificially lowered survival curve because the follow-up time that censored patients contribute is excluded (purple line)</li>
<li>The true survival curve for the <code>lung</code> data is shown in blue for comparison</li>
</ul>
<p><img src="survival_analysis_in_r_tutorial_files/figure-html/unnamed-chunk-9-1.png" width="480" /></p>
</div>
<div id="comparing-survival-times-between-groups" class="section level2">
<h2>Comparing survival times between groups</h2>
<ul>
<li>We can conduct between-group significance tests using a log-rank test</li>
<li>The log-rank test equally weights observations over the entire follow-up time and is the most common way to compare survival times between groups</li>
<li>There are versions that more heavily weight the early or late follow-up that could be more appropriate depending on the research question (see <code>?survdiff</code> for different test options)</li>
</ul>
<p>We get the log-rank p-value using the <code>survdiff</code> function. For example, we can test whether there was a difference in survival time according to sex in the <code>lung</code> data</p>
<pre class="r"><code>survdiff(Surv(time, status) ~ sex, data = lung)</code></pre>
<pre><code>## Call:
## survdiff(formula = Surv(time, status) ~ sex, data = lung)
## 
##         N Observed Expected (O-E)^2/E (O-E)^2/V
## sex=1 138      112     91.6      4.55      10.3
## sex=2  90       53     73.4      5.68      10.3
## 
##  Chisq= 10.3  on 1 degrees of freedom, p= 0.001</code></pre>
</div>
<div id="extracting-information-from-a-survdiff-object" class="section level2">
<h2>Extracting information from a survdiff object</h2>
<p>It’s actually a bit cumbersome to extract a p-value from the results of <code>survdiff</code>. Here’s a line of code to do it</p>
<pre class="r"><code>sd &lt;- survdiff(Surv(time, status) ~ sex, data = lung)
1 - pchisq(sd$chisq, length(sd$n) - 1)</code></pre>
<pre><code>## [1] 0.001311165</code></pre>
<p>Or there is the <code>sdp</code> function in the <code>ezfun</code> package, which you can install using <code>devtools::install_github("zabore/ezfun")</code>. It returns a formatted p-value</p>
<pre class="r"><code>ezfun::sdp(sd)</code></pre>
<pre><code>## [1] 0.001</code></pre>
</div>
<div id="the-cox-regression-model" class="section level2">
<h2>The Cox regression model</h2>
<p>We may want to quantify an effect size for a single variable, or include more than one variable into a regression model to account for the effects of multiple variables.</p>
<p>The Cox regression model is a semi-parametric model that can be used to fit univariable and multivariable regression models that have survival outcomes.</p>
<p><span class="math display">\[h(t|X_i) = h_0(t) \exp(\beta_1 X_{i1} + \cdots + \beta_p X_{ip})\]</span></p>
<p><span class="math inline">\(h(t)\)</span>: hazard, or the instantaneous rate at which events occur <span class="math inline">\(h_0(t)\)</span>: underlying baseline hazard</p>
<p>Some key assumptions of the model:</p>
<ul>
<li>non-informative censoring</li>
<li>proportional hazards</li>
</ul>
<p><em>Note</em>: parametric regression models for survival outcomes are also available, but they won’t be addressed in this training</p>
<p>We can fit regression models for survival data using the <code>coxph</code> function, which takes a <code>Surv</code> object on the left hand side and has standard syntax for regression formulas in <code>R</code> on the right hand side.</p>
<pre class="r"><code>coxph(Surv(time, status) ~ sex, data = lung)</code></pre>
<pre><code>## Call:
## coxph(formula = Surv(time, status) ~ sex, data = lung)
## 
##        coef exp(coef) se(coef)      z       p
## sex -0.5310    0.5880   0.1672 -3.176 0.00149
## 
## Likelihood ratio test=10.63  on 1 df, p=0.001111
## n= 228, number of events= 165</code></pre>
</div>
<div id="formatting-cox-regression-results" class="section level2">
<h2>Formatting Cox regression results</h2>
<p>We can see a tidy version of the output using the <code>tidy</code> function from the <code>broom</code> package:</p>
<pre class="r"><code>broom::tidy(
  coxph(Surv(time, status) ~ sex, data = lung), 
  exp = TRUE
  ) %&gt;% 
  kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
<th align="right">conf.low</th>
<th align="right">conf.high</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">sex</td>
<td align="right">0.5880028</td>
<td align="right">0.1671786</td>
<td align="right">-3.176385</td>
<td align="right">0.0014912</td>
<td align="right">0.4237178</td>
<td align="right">0.8159848</td>
</tr>
</tbody>
</table>
<p>Or use <code>tbl_regression</code> from the <code>gtsummary</code> package</p>
<pre class="r"><code>coxph(Surv(time, status) ~ sex, data = lung) %&gt;% 
  gtsummary::tbl_regression(exp = TRUE) </code></pre>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#bthodvqsjj .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  /* table.margin.left */
  margin-right: auto;
  /* table.margin.right */
  color: #333333;
  font-size: 16px;
  /* table.font.size */
  background-color: #FFFFFF;
  /* table.background.color */
  width: auto;
  /* table.width */
  border-top-style: solid;
  /* table.border.top.style */
  border-top-width: 2px;
  /* table.border.top.width */
  border-top-color: #A8A8A8;
  /* table.border.top.color */
  border-bottom-style: solid;
  /* table.border.bottom.style */
  border-bottom-width: 2px;
  /* table.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* table.border.bottom.color */
}

#bthodvqsjj .gt_heading {
  background-color: #FFFFFF;
  /* heading.background.color */
  border-bottom-color: #FFFFFF;
  /* table.background.color */
  border-left-style: hidden;
  /* heading.border.lr.style */
  border-left-width: 1px;
  /* heading.border.lr.width */
  border-left-color: #D3D3D3;
  /* heading.border.lr.color */
  border-right-style: hidden;
  /* heading.border.lr.style */
  border-right-width: 1px;
  /* heading.border.lr.width */
  border-right-color: #D3D3D3;
  /* heading.border.lr.color */
}

#bthodvqsjj .gt_title {
  color: #333333;
  font-size: 125%;
  /* heading.title.font.size */
  font-weight: initial;
  /* heading.title.font.weight */
  padding-top: 4px;
  /* heading.top.padding - not yet used */
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  /* table.background.color */
  border-bottom-width: 0;
}

#bthodvqsjj .gt_subtitle {
  color: #333333;
  font-size: 85%;
  /* heading.subtitle.font.size */
  font-weight: initial;
  /* heading.subtitle.font.weight */
  padding-top: 0;
  padding-bottom: 4px;
  /* heading.bottom.padding - not yet used */
  border-top-color: #FFFFFF;
  /* table.background.color */
  border-top-width: 0;
}

#bthodvqsjj .gt_bottom_border {
  border-bottom-style: solid;
  /* heading.border.bottom.style */
  border-bottom-width: 2px;
  /* heading.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* heading.border.bottom.color */
}

#bthodvqsjj .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  padding-top: 4px;
  padding-bottom: 4px;
}

#bthodvqsjj .gt_col_headings {
  border-top-style: solid;
  /* column_labels.border.top.style */
  border-top-width: 2px;
  /* column_labels.border.top.width */
  border-top-color: #D3D3D3;
  /* column_labels.border.top.color */
  border-bottom-style: solid;
  /* column_labels.border.bottom.style */
  border-bottom-width: 2px;
  /* column_labels.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* column_labels.border.bottom.color */
  border-left-style: none;
  /* column_labels.border.lr.style */
  border-left-width: 1px;
  /* column_labels.border.lr.width */
  border-left-color: #D3D3D3;
  /* column_labels.border.lr.color */
  border-right-style: none;
  /* column_labels.border.lr.style */
  border-right-width: 1px;
  /* column_labels.border.lr.width */
  border-right-color: #D3D3D3;
  /* column_labels.border.lr.color */
}

#bthodvqsjj .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  /* column_labels.background.color */
  font-size: 100%;
  /* column_labels.font.size */
  font-weight: initial;
  /* column_labels.font.weight */
  text-transform: inherit;
  /* column_labels.text_transform */
  vertical-align: middle;
  padding: 5px;
  margin: 10px;
  overflow-x: hidden;
}

#bthodvqsjj .gt_sep_right {
  border-right: 5px solid #FFFFFF;
}

#bthodvqsjj .gt_group_heading {
  padding: 8px;
  /* row_group.padding */
  color: #333333;
  background-color: #FFFFFF;
  /* row_group.background.color */
  font-size: 100%;
  /* row_group.font.size */
  font-weight: initial;
  /* row_group.font.weight */
  text-transform: inherit;
  /* row_group.text_transform */
  border-top-style: solid;
  /* row_group.border.top.style */
  border-top-width: 2px;
  /* row_group.border.top.width */
  border-top-color: #D3D3D3;
  /* row_group.border.top.color */
  border-bottom-style: solid;
  /* row_group.border.bottom.style */
  border-bottom-width: 2px;
  /* row_group.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* row_group.border.bottom.color */
  border-left-style: none;
  /* row_group.border.left.style */
  border-left-width: 1px;
  /* row_group.border.left.width */
  border-left-color: #D3D3D3;
  /* row_group.border.left.color */
  border-right-style: none;
  /* row_group.border.right.style */
  border-right-width: 1px;
  /* row_group.border.right.width */
  border-right-color: #D3D3D3;
  /* row_group.border.right.color */
  vertical-align: middle;
}

#bthodvqsjj .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  /* row_group.background.color */
  font-size: 100%;
  /* row_group.font.size */
  font-weight: initial;
  /* row_group.font.weight */
  border-top-style: solid;
  /* row_group.border.top.style */
  border-top-width: 2px;
  /* row_group.border.top.width */
  border-top-color: #D3D3D3;
  /* row_group.border.top.color */
  border-bottom-style: solid;
  /* row_group.border.bottom.style */
  border-bottom-width: 2px;
  /* row_group.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* row_group.border.bottom.color */
  vertical-align: middle;
}

#bthodvqsjj .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
  /* row.striping.background_color */
}

#bthodvqsjj .gt_from_md > :first-child {
  margin-top: 0;
}

#bthodvqsjj .gt_from_md > :last-child {
  margin-bottom: 0;
}

#bthodvqsjj .gt_row {
  padding-top: 8px;
  /* data_row.padding */
  padding-bottom: 8px;
  /* data_row.padding */
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  /* table_body.hlines.style */
  border-top-width: 1px;
  /* table_body.hlines.width */
  border-top-color: #D3D3D3;
  /* table_body.hlines.color */
  border-left-style: none;
  /* table_body.vlines.style */
  border-left-width: 1px;
  /* table_body.vlines.width */
  border-left-color: #D3D3D3;
  /* table_body.vlines.color */
  border-right-style: none;
  /* table_body.vlines.style */
  border-right-width: 1px;
  /* table_body.vlines.width */
  border-right-color: #D3D3D3;
  /* table_body.vlines.color */
  vertical-align: middle;
  overflow-x: hidden;
}

#bthodvqsjj .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  /* stub.background.color */
  font-weight: initial;
  /* stub.font.weight */
  text-transform: inherit;
  /* stub.text_transform */
  border-right-style: solid;
  /* stub.border.style */
  border-right-width: 2px;
  /* stub.border.width */
  border-right-color: #D3D3D3;
  /* stub.border.color */
  padding-left: 12px;
}

#bthodvqsjj .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  /* summary_row.background.color */
  text-transform: inherit;
  /* summary_row.text_transform */
  padding-top: 8px;
  /* summary_row.padding */
  padding-bottom: 8px;
  /* summary_row.padding */
  padding-left: 5px;
  padding-right: 5px;
}

#bthodvqsjj .gt_first_summary_row {
  padding-top: 8px;
  /* summary_row.padding */
  padding-bottom: 8px;
  /* summary_row.padding */
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  /* summary_row.border.style */
  border-top-width: 2px;
  /* summary_row.border.width */
  border-top-color: #D3D3D3;
  /* summary_row.border.color */
}

#bthodvqsjj .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  /* grand_summary_row.background.color */
  text-transform: inherit;
  /* grand_summary_row.text_transform */
  padding-top: 8px;
  /* grand_summary_row.padding */
  padding-bottom: 8px;
  /* grand_summary_row.padding */
  padding-left: 5px;
  padding-right: 5px;
}

#bthodvqsjj .gt_first_grand_summary_row {
  padding-top: 8px;
  /* grand_summary_row.padding */
  padding-bottom: 8px;
  /* grand_summary_row.padding */
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  /* grand_summary_row.border.style */
  border-top-width: 6px;
  /* grand_summary_row.border.width */
  border-top-color: #D3D3D3;
  /* grand_summary_row.border.color */
}

#bthodvqsjj .gt_table_body {
  border-top-style: solid;
  /* table_body.border.top.style */
  border-top-width: 2px;
  /* table_body.border.top.width */
  border-top-color: #D3D3D3;
  /* table_body.border.top.color */
  border-bottom-style: solid;
  /* table_body.border.bottom.style */
  border-bottom-width: 2px;
  /* table_body.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* table_body.border.bottom.color */
}

#bthodvqsjj .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  /* footnotes.background.color */
  border-bottom-style: none;
  /* footnotes.border.bottom.style */
  border-bottom-width: 2px;
  /* footnotes.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* footnotes.border.bottom.color */
  border-left-style: none;
  /* footnotes.border.lr.color */
  border-left-width: 2px;
  /* footnotes.border.lr.color */
  border-left-color: #D3D3D3;
  /* footnotes.border.lr.color */
  border-right-style: none;
  /* footnotes.border.lr.color */
  border-right-width: 2px;
  /* footnotes.border.lr.color */
  border-right-color: #D3D3D3;
  /* footnotes.border.lr.color */
}

#bthodvqsjj .gt_footnote {
  margin: 0px;
  font-size: 90%;
  /* footnotes.font.size */
  padding: 4px;
  /* footnotes.padding */
}

#bthodvqsjj .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  /* source_notes.background.color */
  border-bottom-style: none;
  /* source_notes.border.bottom.style */
  border-bottom-width: 2px;
  /* source_notes.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* source_notes.border.bottom.color */
  border-left-style: none;
  /* source_notes.border.lr.style */
  border-left-width: 2px;
  /* source_notes.border.lr.style */
  border-left-color: #D3D3D3;
  /* source_notes.border.lr.style */
  border-right-style: none;
  /* source_notes.border.lr.style */
  border-right-width: 2px;
  /* source_notes.border.lr.style */
  border-right-color: #D3D3D3;
  /* source_notes.border.lr.style */
}

#bthodvqsjj .gt_sourcenote {
  font-size: 90%;
  /* source_notes.font.size */
  padding: 4px;
  /* source_notes.padding */
}

#bthodvqsjj .gt_left {
  text-align: left;
}

#bthodvqsjj .gt_center {
  text-align: center;
}

#bthodvqsjj .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#bthodvqsjj .gt_font_normal {
  font-weight: normal;
}

#bthodvqsjj .gt_font_bold {
  font-weight: bold;
}

#bthodvqsjj .gt_font_italic {
  font-style: italic;
}

#bthodvqsjj .gt_super {
  font-size: 65%;
}

#bthodvqsjj .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="bthodvqsjj" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>HR</strong><sup class="gt_footnote_marks">1</sup></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>95% CI</strong><sup class="gt_footnote_marks">1</sup></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">sex</td>
      <td class="gt_row gt_center">0.59</td>
      <td class="gt_row gt_center">0.42, 0.82</td>
      <td class="gt_row gt_center">0.001</td>
    </tr>
  </tbody>
  
  <tfoot>
    <tr class="gt_footnotes">
      <td colspan="4">
        <p class="gt_footnote">
          <sup class="gt_footnote_marks">
            <em>1</em>
          </sup>
           
          HR = Hazard Ratio, CI = Confidence Interval
          <br />
        </p>
      </td>
    </tr>
  </tfoot>
</table></div>
</div>
<div id="hazard-ratios" class="section level2">
<h2>Hazard ratios</h2>
<ul>
<li><p>The quantity of interest from a Cox regression model is a <strong>hazard ratio (HR)</strong>. The HR represents the ratio of hazards between two groups at any particular point in time.</p></li>
<li><p>The HR is interpreted as the instantaneous rate of occurrence of the event of interest in those who are still at risk for the event. It is <strong>not</strong> a risk, though it is commonly interpreted as such.</p></li>
<li><p>If you have a regression parameter <span class="math inline">\(\beta\)</span> (from column <code>estimate</code> in our <code>coxph</code>) then HR = <span class="math inline">\(\exp(\beta)\)</span>.</p></li>
<li><p>A HR &lt; 1 indicates reduced hazard of death whereas a HR &gt; 1 indicates an increased hazard of death.</p></li>
<li><p>So our HR = 0.59 implies that around 0.6 times as many females are dying as males, at any given time.</p></li>
</ul>
<p><img src="survival_analysis_in_r_tutorial_files/figure-html/unnamed-chunk-16-1.png" width="480" /></p>
</div>
</div>
<div id="part-2-landmark-analysis-and-time-dependent-covariates" class="section level1">
<h1>Part 2: Landmark Analysis and Time Dependent Covariates</h1>
<p>In Part 1 we covered using log-rank tests and Cox regression to examine associations between covariates of interest and survival outcomes.</p>
<p>But these analyses rely on the covariate being measured at <strong>baseline</strong>, that is, before follow-up time for the event begins.</p>
<p>What happens if you are interested in a covariate that is measured <strong>after</strong> follow-up time begins?</p>
<div id="example-tumor-response" class="section level2">
<h2>Example: tumor response</h2>
<p>Example: Overall survival is measured from treatment start, and interest is in the association between complete response to treatment and survival.</p>
<ul>
<li>Anderson et al (JCO, 1983) described why tradional methods such as log-rank tests or Cox regression are biased in favor of responders in this scenario and proposed the landmark approach.</li>
<li>The <strong>null hypothesis</strong> in the landmark approach is that survival from landmark does not depend on response status at landmark.</li>
</ul>
<blockquote>
<p>Anderson, J., Cain, K., &amp; Gelber, R. (1983). Analysis of survival by tumor response. Journal of Clinical Oncology : Official Journal of the American Society of Clinical Oncology, 1(11), 710-9.</p>
</blockquote>
</div>
<div id="other-examples" class="section level2">
<h2>Other examples</h2>
<p>Some other possible covariates of interest in cancer research that may not be measured at baseline include:</p>
<ul>
<li>tranplant failure</li>
<li>graft versus host disease</li>
<li>second resection</li>
<li>adjuvant therapy</li>
<li>compliance</li>
<li>adverse events</li>
</ul>
</div>
<div id="example-data---the-bmt-dataset-from-semicomprisks-package" class="section level2">
<h2>Example data - the BMT dataset from SemiCompRisks package</h2>
<p>Data on 137 bone marrow transplant patients. Variables of interest include:</p>
<ul>
<li><code>T1</code> time (in days) to death or last follow-up</li>
<li><code>delta1</code> death indicator; 1-Dead, 0-Alive</li>
<li><code>TA</code> time (in days) to acute graft-versus-host disease</li>
<li><code>deltaA</code> acute graft-versus-host disease indicator; 1-Developed acute graft-versus-host disease, 0-Never developed acute graft-versus-host disease</li>
</ul>
<p>Let’s load the data for use in examples throughout</p>
<pre class="r"><code>data(BMT, package = &quot;SemiCompRisks&quot;)</code></pre>
</div>
<div id="landmark-method" class="section level2">
<h2>Landmark method</h2>
<ol style="list-style-type: decimal">
<li>Select a fixed time after baseline as your landmark time. <em>Note</em>: this should be done based on clinical information, prior to data inspection</li>
<li>Subset population for those followed at least until landmark time. <em>Note</em>: always report the number excluded due to the event of interest or censoring prior to the landmark time.</li>
<li>Calculate follow-up from landmark time and apply traditional log-rank tests or Cox regression</li>
</ol>
<p>In the <code>BMT</code> data interest is in the association between acute graft versus host disease (aGVHD) and survival. But aGVHD is assessed after the transplant, which is our baseline, or start of follow-up, time.</p>
<p><strong>Step 1</strong> Select landmark time</p>
<p>Typically aGVHD occurs within the first 90 days following transplant, so we use a 90-day landmark.</p>
<p>Interest is in the association between acute graft versus host disease (aGVHD) and survival. But aGVHD is assessed after the transplant, which is our baseline, or start of follow-up, time.</p>
<p><strong>Step 2</strong> Subset population for those followed at least until landmark time</p>
<pre class="r"><code>lm_dat &lt;- 
  BMT %&gt;% 
  filter(T1 &gt;= 90) </code></pre>
<p>This reduces our sample size from 137 to 122.</p>
<ul>
<li>All 15 excluded patients died before the 90 day landmark</li>
</ul>
<p>Interest is in the association between acute graft versus host disease (aGVHD) and survival. But aGVHD is assessed after the transplant, which is our baseline, or start of follow-up, time.</p>
<p><strong>Step 3</strong> Calculate follow-up time from landmark and apply traditional methods.</p>
<pre class="r"><code>lm_dat &lt;- 
  lm_dat %&gt;% 
  mutate(
    lm_T1 = T1 - 90
    )

lm_fit &lt;- survfit(Surv(lm_T1, delta1) ~ deltaA, data = lm_dat)</code></pre>
<p><img src="survival_analysis_in_r_tutorial_files/figure-html/unnamed-chunk-20-1.png" width="480" /></p>
</div>
<div id="cox-regression-landmark-example-using-bmt-data" class="section level2">
<h2>Cox regression landmark example using BMT data</h2>
<p>In Cox regression you can use the <code>subset</code> option in <code>coxph</code> to exclude those patients who were not followed through the landmark time</p>
<pre class="r"><code>coxph(
  Surv(T1, delta1) ~ deltaA, 
  subset = T1 &gt;= 90, 
  data = BMT
  ) %&gt;% 
  gtsummary::tbl_regression(exp = TRUE)</code></pre>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#dmpqwnvorn .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  /* table.margin.left */
  margin-right: auto;
  /* table.margin.right */
  color: #333333;
  font-size: 16px;
  /* table.font.size */
  background-color: #FFFFFF;
  /* table.background.color */
  width: auto;
  /* table.width */
  border-top-style: solid;
  /* table.border.top.style */
  border-top-width: 2px;
  /* table.border.top.width */
  border-top-color: #A8A8A8;
  /* table.border.top.color */
  border-bottom-style: solid;
  /* table.border.bottom.style */
  border-bottom-width: 2px;
  /* table.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* table.border.bottom.color */
}

#dmpqwnvorn .gt_heading {
  background-color: #FFFFFF;
  /* heading.background.color */
  border-bottom-color: #FFFFFF;
  /* table.background.color */
  border-left-style: hidden;
  /* heading.border.lr.style */
  border-left-width: 1px;
  /* heading.border.lr.width */
  border-left-color: #D3D3D3;
  /* heading.border.lr.color */
  border-right-style: hidden;
  /* heading.border.lr.style */
  border-right-width: 1px;
  /* heading.border.lr.width */
  border-right-color: #D3D3D3;
  /* heading.border.lr.color */
}

#dmpqwnvorn .gt_title {
  color: #333333;
  font-size: 125%;
  /* heading.title.font.size */
  font-weight: initial;
  /* heading.title.font.weight */
  padding-top: 4px;
  /* heading.top.padding - not yet used */
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  /* table.background.color */
  border-bottom-width: 0;
}

#dmpqwnvorn .gt_subtitle {
  color: #333333;
  font-size: 85%;
  /* heading.subtitle.font.size */
  font-weight: initial;
  /* heading.subtitle.font.weight */
  padding-top: 0;
  padding-bottom: 4px;
  /* heading.bottom.padding - not yet used */
  border-top-color: #FFFFFF;
  /* table.background.color */
  border-top-width: 0;
}

#dmpqwnvorn .gt_bottom_border {
  border-bottom-style: solid;
  /* heading.border.bottom.style */
  border-bottom-width: 2px;
  /* heading.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* heading.border.bottom.color */
}

#dmpqwnvorn .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  padding-top: 4px;
  padding-bottom: 4px;
}

#dmpqwnvorn .gt_col_headings {
  border-top-style: solid;
  /* column_labels.border.top.style */
  border-top-width: 2px;
  /* column_labels.border.top.width */
  border-top-color: #D3D3D3;
  /* column_labels.border.top.color */
  border-bottom-style: solid;
  /* column_labels.border.bottom.style */
  border-bottom-width: 2px;
  /* column_labels.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* column_labels.border.bottom.color */
  border-left-style: none;
  /* column_labels.border.lr.style */
  border-left-width: 1px;
  /* column_labels.border.lr.width */
  border-left-color: #D3D3D3;
  /* column_labels.border.lr.color */
  border-right-style: none;
  /* column_labels.border.lr.style */
  border-right-width: 1px;
  /* column_labels.border.lr.width */
  border-right-color: #D3D3D3;
  /* column_labels.border.lr.color */
}

#dmpqwnvorn .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  /* column_labels.background.color */
  font-size: 100%;
  /* column_labels.font.size */
  font-weight: initial;
  /* column_labels.font.weight */
  text-transform: inherit;
  /* column_labels.text_transform */
  vertical-align: middle;
  padding: 5px;
  margin: 10px;
  overflow-x: hidden;
}

#dmpqwnvorn .gt_sep_right {
  border-right: 5px solid #FFFFFF;
}

#dmpqwnvorn .gt_group_heading {
  padding: 8px;
  /* row_group.padding */
  color: #333333;
  background-color: #FFFFFF;
  /* row_group.background.color */
  font-size: 100%;
  /* row_group.font.size */
  font-weight: initial;
  /* row_group.font.weight */
  text-transform: inherit;
  /* row_group.text_transform */
  border-top-style: solid;
  /* row_group.border.top.style */
  border-top-width: 2px;
  /* row_group.border.top.width */
  border-top-color: #D3D3D3;
  /* row_group.border.top.color */
  border-bottom-style: solid;
  /* row_group.border.bottom.style */
  border-bottom-width: 2px;
  /* row_group.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* row_group.border.bottom.color */
  border-left-style: none;
  /* row_group.border.left.style */
  border-left-width: 1px;
  /* row_group.border.left.width */
  border-left-color: #D3D3D3;
  /* row_group.border.left.color */
  border-right-style: none;
  /* row_group.border.right.style */
  border-right-width: 1px;
  /* row_group.border.right.width */
  border-right-color: #D3D3D3;
  /* row_group.border.right.color */
  vertical-align: middle;
}

#dmpqwnvorn .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  /* row_group.background.color */
  font-size: 100%;
  /* row_group.font.size */
  font-weight: initial;
  /* row_group.font.weight */
  border-top-style: solid;
  /* row_group.border.top.style */
  border-top-width: 2px;
  /* row_group.border.top.width */
  border-top-color: #D3D3D3;
  /* row_group.border.top.color */
  border-bottom-style: solid;
  /* row_group.border.bottom.style */
  border-bottom-width: 2px;
  /* row_group.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* row_group.border.bottom.color */
  vertical-align: middle;
}

#dmpqwnvorn .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
  /* row.striping.background_color */
}

#dmpqwnvorn .gt_from_md > :first-child {
  margin-top: 0;
}

#dmpqwnvorn .gt_from_md > :last-child {
  margin-bottom: 0;
}

#dmpqwnvorn .gt_row {
  padding-top: 8px;
  /* data_row.padding */
  padding-bottom: 8px;
  /* data_row.padding */
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  /* table_body.hlines.style */
  border-top-width: 1px;
  /* table_body.hlines.width */
  border-top-color: #D3D3D3;
  /* table_body.hlines.color */
  border-left-style: none;
  /* table_body.vlines.style */
  border-left-width: 1px;
  /* table_body.vlines.width */
  border-left-color: #D3D3D3;
  /* table_body.vlines.color */
  border-right-style: none;
  /* table_body.vlines.style */
  border-right-width: 1px;
  /* table_body.vlines.width */
  border-right-color: #D3D3D3;
  /* table_body.vlines.color */
  vertical-align: middle;
  overflow-x: hidden;
}

#dmpqwnvorn .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  /* stub.background.color */
  font-weight: initial;
  /* stub.font.weight */
  text-transform: inherit;
  /* stub.text_transform */
  border-right-style: solid;
  /* stub.border.style */
  border-right-width: 2px;
  /* stub.border.width */
  border-right-color: #D3D3D3;
  /* stub.border.color */
  padding-left: 12px;
}

#dmpqwnvorn .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  /* summary_row.background.color */
  text-transform: inherit;
  /* summary_row.text_transform */
  padding-top: 8px;
  /* summary_row.padding */
  padding-bottom: 8px;
  /* summary_row.padding */
  padding-left: 5px;
  padding-right: 5px;
}

#dmpqwnvorn .gt_first_summary_row {
  padding-top: 8px;
  /* summary_row.padding */
  padding-bottom: 8px;
  /* summary_row.padding */
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  /* summary_row.border.style */
  border-top-width: 2px;
  /* summary_row.border.width */
  border-top-color: #D3D3D3;
  /* summary_row.border.color */
}

#dmpqwnvorn .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  /* grand_summary_row.background.color */
  text-transform: inherit;
  /* grand_summary_row.text_transform */
  padding-top: 8px;
  /* grand_summary_row.padding */
  padding-bottom: 8px;
  /* grand_summary_row.padding */
  padding-left: 5px;
  padding-right: 5px;
}

#dmpqwnvorn .gt_first_grand_summary_row {
  padding-top: 8px;
  /* grand_summary_row.padding */
  padding-bottom: 8px;
  /* grand_summary_row.padding */
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  /* grand_summary_row.border.style */
  border-top-width: 6px;
  /* grand_summary_row.border.width */
  border-top-color: #D3D3D3;
  /* grand_summary_row.border.color */
}

#dmpqwnvorn .gt_table_body {
  border-top-style: solid;
  /* table_body.border.top.style */
  border-top-width: 2px;
  /* table_body.border.top.width */
  border-top-color: #D3D3D3;
  /* table_body.border.top.color */
  border-bottom-style: solid;
  /* table_body.border.bottom.style */
  border-bottom-width: 2px;
  /* table_body.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* table_body.border.bottom.color */
}

#dmpqwnvorn .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  /* footnotes.background.color */
  border-bottom-style: none;
  /* footnotes.border.bottom.style */
  border-bottom-width: 2px;
  /* footnotes.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* footnotes.border.bottom.color */
  border-left-style: none;
  /* footnotes.border.lr.color */
  border-left-width: 2px;
  /* footnotes.border.lr.color */
  border-left-color: #D3D3D3;
  /* footnotes.border.lr.color */
  border-right-style: none;
  /* footnotes.border.lr.color */
  border-right-width: 2px;
  /* footnotes.border.lr.color */
  border-right-color: #D3D3D3;
  /* footnotes.border.lr.color */
}

#dmpqwnvorn .gt_footnote {
  margin: 0px;
  font-size: 90%;
  /* footnotes.font.size */
  padding: 4px;
  /* footnotes.padding */
}

#dmpqwnvorn .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  /* source_notes.background.color */
  border-bottom-style: none;
  /* source_notes.border.bottom.style */
  border-bottom-width: 2px;
  /* source_notes.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* source_notes.border.bottom.color */
  border-left-style: none;
  /* source_notes.border.lr.style */
  border-left-width: 2px;
  /* source_notes.border.lr.style */
  border-left-color: #D3D3D3;
  /* source_notes.border.lr.style */
  border-right-style: none;
  /* source_notes.border.lr.style */
  border-right-width: 2px;
  /* source_notes.border.lr.style */
  border-right-color: #D3D3D3;
  /* source_notes.border.lr.style */
}

#dmpqwnvorn .gt_sourcenote {
  font-size: 90%;
  /* source_notes.font.size */
  padding: 4px;
  /* source_notes.padding */
}

#dmpqwnvorn .gt_left {
  text-align: left;
}

#dmpqwnvorn .gt_center {
  text-align: center;
}

#dmpqwnvorn .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#dmpqwnvorn .gt_font_normal {
  font-weight: normal;
}

#dmpqwnvorn .gt_font_bold {
  font-weight: bold;
}

#dmpqwnvorn .gt_font_italic {
  font-style: italic;
}

#dmpqwnvorn .gt_super {
  font-size: 65%;
}

#dmpqwnvorn .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="dmpqwnvorn" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>HR</strong><sup class="gt_footnote_marks">1</sup></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>95% CI</strong><sup class="gt_footnote_marks">1</sup></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">deltaA</td>
      <td class="gt_row gt_center">1.08</td>
      <td class="gt_row gt_center">0.57, 2.07</td>
      <td class="gt_row gt_center">0.8</td>
    </tr>
  </tbody>
  
  <tfoot>
    <tr class="gt_footnotes">
      <td colspan="4">
        <p class="gt_footnote">
          <sup class="gt_footnote_marks">
            <em>1</em>
          </sup>
           
          HR = Hazard Ratio, CI = Confidence Interval
          <br />
        </p>
      </td>
    </tr>
  </tfoot>
</table></div>
</div>
<div id="time-dependent-covariate" class="section level2">
<h2>Time-dependent covariate</h2>
<p>An alternative to a landmark analysis is incorporation of a time-dependent covariate. This may be more appropriate when</p>
<ul>
<li>the value of a covariate is changing over time</li>
<li>there is not an obvious landmark time</li>
<li>use of a landmark would lead to many exclusions</li>
</ul>
</div>
<div id="time-dependent-covariate-data-setup" class="section level2">
<h2>Time-dependent covariate data setup</h2>
<p>Analysis of time-dependent covariates in <code>R</code> requires setup of a special dataset. See the detailed paper on this by the author of the <code>survival</code> package <a href="https://cran.r-project.org/web/packages/survival/vignettes/timedep.pdf">Using Time Dependent Covariates and Time Dependent Coefficients in the Cox Model</a>.</p>
<p>There was no ID variable in the <code>BMT</code> data, which is needed to create the special dataset, so create one called <code>my_id</code>.</p>
<pre class="r"><code>bmt &lt;- rowid_to_column(BMT, &quot;my_id&quot;)</code></pre>
<p>Use the <code>tmerge</code> function with the <code>event</code> and <code>tdc</code> function options to create the special dataset.</p>
<ul>
<li><code>tmerge</code> creates a long dataset with multiple time intervals for the different covariate values for each patient</li>
<li><code>event</code> creates the new event indicator to go with the newly created time intervals</li>
<li><code>tdc</code> creates the time-dependent covariate indicator to go with the newly created time intervals</li>
</ul>
<pre class="r"><code>td_dat &lt;- 
  tmerge(
    data1 = bmt %&gt;% select(my_id, T1, delta1), 
    data2 = bmt %&gt;% select(my_id, T1, delta1, TA, deltaA), 
    id = my_id, 
    death = event(T1, delta1),
    agvhd = tdc(TA)
    )</code></pre>
</div>
<div id="time-dependent-covariate---single-patient-example" class="section level2">
<h2>Time-dependent covariate - single patient example</h2>
<p>To see what this does, let’s look at the data for the first 5 individual patients.</p>
<p>The variables of interest in the original data looked like</p>
<pre><code>##   my_id   T1 delta1   TA deltaA
## 1     1 2081      0   67      1
## 2     2 1602      0 1602      0
## 3     3 1496      0 1496      0
## 4     4 1462      0   70      1
## 5     5 1433      0 1433      0</code></pre>
<p>The new dataset for these same patients looks like</p>
<pre><code>##   my_id   T1 delta1 id tstart tstop death agvhd
## 1     1 2081      0  1      0    67     0     0
## 2     1 2081      0  1     67  2081     0     1
## 3     2 1602      0  2      0  1602     0     0
## 4     3 1496      0  3      0  1496     0     0
## 5     4 1462      0  4      0    70     0     0
## 6     4 1462      0  4     70  1462     0     1
## 7     5 1433      0  5      0  1433     0     0</code></pre>
</div>
<div id="time-dependent-covariate---cox-regression" class="section level2">
<h2>Time-dependent covariate - Cox regression</h2>
<p>Now we can analyze this time-dependent covariate as usual using Cox regression with <code>coxph</code> and an alteration to our use of <code>Surv</code> to include arguments to both <code>time</code> and <code>time2</code></p>
<pre class="r"><code>coxph(
  Surv(time = tstart, time2 = tstop, event = death) ~ agvhd, 
  data = td_dat
  ) %&gt;% 
  gtsummary::tbl_regression(exp = TRUE)</code></pre>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#vcipwnwpuw .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  /* table.margin.left */
  margin-right: auto;
  /* table.margin.right */
  color: #333333;
  font-size: 16px;
  /* table.font.size */
  background-color: #FFFFFF;
  /* table.background.color */
  width: auto;
  /* table.width */
  border-top-style: solid;
  /* table.border.top.style */
  border-top-width: 2px;
  /* table.border.top.width */
  border-top-color: #A8A8A8;
  /* table.border.top.color */
  border-bottom-style: solid;
  /* table.border.bottom.style */
  border-bottom-width: 2px;
  /* table.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* table.border.bottom.color */
}

#vcipwnwpuw .gt_heading {
  background-color: #FFFFFF;
  /* heading.background.color */
  border-bottom-color: #FFFFFF;
  /* table.background.color */
  border-left-style: hidden;
  /* heading.border.lr.style */
  border-left-width: 1px;
  /* heading.border.lr.width */
  border-left-color: #D3D3D3;
  /* heading.border.lr.color */
  border-right-style: hidden;
  /* heading.border.lr.style */
  border-right-width: 1px;
  /* heading.border.lr.width */
  border-right-color: #D3D3D3;
  /* heading.border.lr.color */
}

#vcipwnwpuw .gt_title {
  color: #333333;
  font-size: 125%;
  /* heading.title.font.size */
  font-weight: initial;
  /* heading.title.font.weight */
  padding-top: 4px;
  /* heading.top.padding - not yet used */
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  /* table.background.color */
  border-bottom-width: 0;
}

#vcipwnwpuw .gt_subtitle {
  color: #333333;
  font-size: 85%;
  /* heading.subtitle.font.size */
  font-weight: initial;
  /* heading.subtitle.font.weight */
  padding-top: 0;
  padding-bottom: 4px;
  /* heading.bottom.padding - not yet used */
  border-top-color: #FFFFFF;
  /* table.background.color */
  border-top-width: 0;
}

#vcipwnwpuw .gt_bottom_border {
  border-bottom-style: solid;
  /* heading.border.bottom.style */
  border-bottom-width: 2px;
  /* heading.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* heading.border.bottom.color */
}

#vcipwnwpuw .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  padding-top: 4px;
  padding-bottom: 4px;
}

#vcipwnwpuw .gt_col_headings {
  border-top-style: solid;
  /* column_labels.border.top.style */
  border-top-width: 2px;
  /* column_labels.border.top.width */
  border-top-color: #D3D3D3;
  /* column_labels.border.top.color */
  border-bottom-style: solid;
  /* column_labels.border.bottom.style */
  border-bottom-width: 2px;
  /* column_labels.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* column_labels.border.bottom.color */
  border-left-style: none;
  /* column_labels.border.lr.style */
  border-left-width: 1px;
  /* column_labels.border.lr.width */
  border-left-color: #D3D3D3;
  /* column_labels.border.lr.color */
  border-right-style: none;
  /* column_labels.border.lr.style */
  border-right-width: 1px;
  /* column_labels.border.lr.width */
  border-right-color: #D3D3D3;
  /* column_labels.border.lr.color */
}

#vcipwnwpuw .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  /* column_labels.background.color */
  font-size: 100%;
  /* column_labels.font.size */
  font-weight: initial;
  /* column_labels.font.weight */
  text-transform: inherit;
  /* column_labels.text_transform */
  vertical-align: middle;
  padding: 5px;
  margin: 10px;
  overflow-x: hidden;
}

#vcipwnwpuw .gt_sep_right {
  border-right: 5px solid #FFFFFF;
}

#vcipwnwpuw .gt_group_heading {
  padding: 8px;
  /* row_group.padding */
  color: #333333;
  background-color: #FFFFFF;
  /* row_group.background.color */
  font-size: 100%;
  /* row_group.font.size */
  font-weight: initial;
  /* row_group.font.weight */
  text-transform: inherit;
  /* row_group.text_transform */
  border-top-style: solid;
  /* row_group.border.top.style */
  border-top-width: 2px;
  /* row_group.border.top.width */
  border-top-color: #D3D3D3;
  /* row_group.border.top.color */
  border-bottom-style: solid;
  /* row_group.border.bottom.style */
  border-bottom-width: 2px;
  /* row_group.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* row_group.border.bottom.color */
  border-left-style: none;
  /* row_group.border.left.style */
  border-left-width: 1px;
  /* row_group.border.left.width */
  border-left-color: #D3D3D3;
  /* row_group.border.left.color */
  border-right-style: none;
  /* row_group.border.right.style */
  border-right-width: 1px;
  /* row_group.border.right.width */
  border-right-color: #D3D3D3;
  /* row_group.border.right.color */
  vertical-align: middle;
}

#vcipwnwpuw .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  /* row_group.background.color */
  font-size: 100%;
  /* row_group.font.size */
  font-weight: initial;
  /* row_group.font.weight */
  border-top-style: solid;
  /* row_group.border.top.style */
  border-top-width: 2px;
  /* row_group.border.top.width */
  border-top-color: #D3D3D3;
  /* row_group.border.top.color */
  border-bottom-style: solid;
  /* row_group.border.bottom.style */
  border-bottom-width: 2px;
  /* row_group.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* row_group.border.bottom.color */
  vertical-align: middle;
}

#vcipwnwpuw .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
  /* row.striping.background_color */
}

#vcipwnwpuw .gt_from_md > :first-child {
  margin-top: 0;
}

#vcipwnwpuw .gt_from_md > :last-child {
  margin-bottom: 0;
}

#vcipwnwpuw .gt_row {
  padding-top: 8px;
  /* data_row.padding */
  padding-bottom: 8px;
  /* data_row.padding */
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  /* table_body.hlines.style */
  border-top-width: 1px;
  /* table_body.hlines.width */
  border-top-color: #D3D3D3;
  /* table_body.hlines.color */
  border-left-style: none;
  /* table_body.vlines.style */
  border-left-width: 1px;
  /* table_body.vlines.width */
  border-left-color: #D3D3D3;
  /* table_body.vlines.color */
  border-right-style: none;
  /* table_body.vlines.style */
  border-right-width: 1px;
  /* table_body.vlines.width */
  border-right-color: #D3D3D3;
  /* table_body.vlines.color */
  vertical-align: middle;
  overflow-x: hidden;
}

#vcipwnwpuw .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  /* stub.background.color */
  font-weight: initial;
  /* stub.font.weight */
  text-transform: inherit;
  /* stub.text_transform */
  border-right-style: solid;
  /* stub.border.style */
  border-right-width: 2px;
  /* stub.border.width */
  border-right-color: #D3D3D3;
  /* stub.border.color */
  padding-left: 12px;
}

#vcipwnwpuw .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  /* summary_row.background.color */
  text-transform: inherit;
  /* summary_row.text_transform */
  padding-top: 8px;
  /* summary_row.padding */
  padding-bottom: 8px;
  /* summary_row.padding */
  padding-left: 5px;
  padding-right: 5px;
}

#vcipwnwpuw .gt_first_summary_row {
  padding-top: 8px;
  /* summary_row.padding */
  padding-bottom: 8px;
  /* summary_row.padding */
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  /* summary_row.border.style */
  border-top-width: 2px;
  /* summary_row.border.width */
  border-top-color: #D3D3D3;
  /* summary_row.border.color */
}

#vcipwnwpuw .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  /* grand_summary_row.background.color */
  text-transform: inherit;
  /* grand_summary_row.text_transform */
  padding-top: 8px;
  /* grand_summary_row.padding */
  padding-bottom: 8px;
  /* grand_summary_row.padding */
  padding-left: 5px;
  padding-right: 5px;
}

#vcipwnwpuw .gt_first_grand_summary_row {
  padding-top: 8px;
  /* grand_summary_row.padding */
  padding-bottom: 8px;
  /* grand_summary_row.padding */
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  /* grand_summary_row.border.style */
  border-top-width: 6px;
  /* grand_summary_row.border.width */
  border-top-color: #D3D3D3;
  /* grand_summary_row.border.color */
}

#vcipwnwpuw .gt_table_body {
  border-top-style: solid;
  /* table_body.border.top.style */
  border-top-width: 2px;
  /* table_body.border.top.width */
  border-top-color: #D3D3D3;
  /* table_body.border.top.color */
  border-bottom-style: solid;
  /* table_body.border.bottom.style */
  border-bottom-width: 2px;
  /* table_body.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* table_body.border.bottom.color */
}

#vcipwnwpuw .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  /* footnotes.background.color */
  border-bottom-style: none;
  /* footnotes.border.bottom.style */
  border-bottom-width: 2px;
  /* footnotes.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* footnotes.border.bottom.color */
  border-left-style: none;
  /* footnotes.border.lr.color */
  border-left-width: 2px;
  /* footnotes.border.lr.color */
  border-left-color: #D3D3D3;
  /* footnotes.border.lr.color */
  border-right-style: none;
  /* footnotes.border.lr.color */
  border-right-width: 2px;
  /* footnotes.border.lr.color */
  border-right-color: #D3D3D3;
  /* footnotes.border.lr.color */
}

#vcipwnwpuw .gt_footnote {
  margin: 0px;
  font-size: 90%;
  /* footnotes.font.size */
  padding: 4px;
  /* footnotes.padding */
}

#vcipwnwpuw .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  /* source_notes.background.color */
  border-bottom-style: none;
  /* source_notes.border.bottom.style */
  border-bottom-width: 2px;
  /* source_notes.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* source_notes.border.bottom.color */
  border-left-style: none;
  /* source_notes.border.lr.style */
  border-left-width: 2px;
  /* source_notes.border.lr.style */
  border-left-color: #D3D3D3;
  /* source_notes.border.lr.style */
  border-right-style: none;
  /* source_notes.border.lr.style */
  border-right-width: 2px;
  /* source_notes.border.lr.style */
  border-right-color: #D3D3D3;
  /* source_notes.border.lr.style */
}

#vcipwnwpuw .gt_sourcenote {
  font-size: 90%;
  /* source_notes.font.size */
  padding: 4px;
  /* source_notes.padding */
}

#vcipwnwpuw .gt_left {
  text-align: left;
}

#vcipwnwpuw .gt_center {
  text-align: center;
}

#vcipwnwpuw .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#vcipwnwpuw .gt_font_normal {
  font-weight: normal;
}

#vcipwnwpuw .gt_font_bold {
  font-weight: bold;
}

#vcipwnwpuw .gt_font_italic {
  font-style: italic;
}

#vcipwnwpuw .gt_super {
  font-size: 65%;
}

#vcipwnwpuw .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="vcipwnwpuw" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>HR</strong><sup class="gt_footnote_marks">1</sup></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>95% CI</strong><sup class="gt_footnote_marks">1</sup></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">agvhd</td>
      <td class="gt_row gt_center">1.40</td>
      <td class="gt_row gt_center">0.81, 2.43</td>
      <td class="gt_row gt_center">0.2</td>
    </tr>
  </tbody>
  
  <tfoot>
    <tr class="gt_footnotes">
      <td colspan="4">
        <p class="gt_footnote">
          <sup class="gt_footnote_marks">
            <em>1</em>
          </sup>
           
          HR = Hazard Ratio, CI = Confidence Interval
          <br />
        </p>
      </td>
    </tr>
  </tfoot>
</table></div>
</div>
<div id="summary" class="section level2">
<h2>Summary</h2>
<p>We find that acute graft versus host disease is not significantly associated with death using either landmark analysis or a time-dependent covariate.</p>
<p>Often one will want to use landmark analysis for visualization of a single covariate, and Cox regression with a time-dependent covariate for univariable and multivariable modeling.</p>
</div>
</div>
<div id="part-3-competing-risks" class="section level1">
<h1>Part 3: Competing Risks</h1>
<div id="packages-1" class="section level2">
<h2>Packages</h2>
<p>The primary package for use in competing risks analyses is</p>
<ul>
<li><code>cmprsk</code></li>
</ul>
<pre class="r"><code>library(cmprsk)</code></pre>
</div>
<div id="what-are-competing-risks" class="section level2">
<h2>What are competing risks?</h2>
<p>When subjects have multiple possible events in a time-to-event setting</p>
<p>Examples:</p>
<ul>
<li>recurrence</li>
<li>death from disease</li>
<li>death from other causes</li>
<li>treatment response</li>
</ul>
<p>All or some of these (among others) may be possible events in any given study.</p>
</div>
<div id="so-whats-the-problem" class="section level2">
<h2>So what’s the problem?</h2>
<p>Unobserved dependence among event times is the fundamental problem that leads to the need for special consideration.</p>
<p>For example, one can imagine that patients who recur are more likely to die, and therefore times to recurrence and times to death would not be independent events.</p>
</div>
<div id="background-on-competing-risks" class="section level2">
<h2>Background on competing risks</h2>
<p>Two approaches to analysis in the presence of multiple potential outcomes:</p>
<ol style="list-style-type: decimal">
<li>Cause-specific hazard of a given event: this represents the rate per unit of time of the event among those not having failed from other events</li>
<li>Cumulative incidence of given event: this represents the rate per unit of time of the event as well as the influence of competing events</li>
</ol>
<p>Each of these approaches may only illuminate one important aspect of the data while possibly obscuring others, and the chosen approach should depend on the question of interest.</p>
</div>
<div id="a-bunch-of-additional-notes-and-references" class="section level2">
<h2>A bunch of additional notes and references</h2>
<ul>
<li>When the events are independent (almost never true), cause-specific hazards is unbiased</li>
<li>When the events are dependent, a variety of results can be obtained depending on the setting</li>
<li>Cumulative incidence using Kaplan-Meier is always &gt;= cumulative incidence using competing risks methods, so can only lead to an overestimate of the cumulative incidence, the amount of overestimation depends on event rates and dependence among events</li>
<li>To establish that a covariate is indeed acting on the event of interest, cause-specific hazards may be preferred for treatment or pronostic marker effect testing</li>
<li>To establish overall benefit, subdistribution hazards may be preferred for building prognostic nomograms or considering health economic effects to get a better sense of the influence of treatment and other covariates on an absolute scale</li>
</ul>
<blockquote>
<p>Dignam JJ, Zhang Q, Kocherginsky M. The use and interpretation of competing risks regression models. Clin Cancer Res. 2012;18(8):2301-8.</p>
</blockquote>
<blockquote>
<p>Kim HT. Cumulative incidence in competing risks data and competing risks regression analysis. Clin Cancer Res. 2007 Jan 15;13(2 Pt 1):559-65.</p>
</blockquote>
<blockquote>
<p>Satagopan JM, Ben-Porat L, Berwick M, Robson M, Kutler D, Auerbach AD. A note on competing risks in survival data analysis. Br J Cancer. 2004;91(7):1229-35.</p>
</blockquote>
<blockquote>
<p>Austin, P., &amp; Fine, J. (2017). Practical recommendations for reporting Fine‐Gray model analyses for competing risk data. Statistics in Medicine, 36(27), 4391-4400.</p>
</blockquote>
</div>
<div id="cumulative-incidence-for-competing-risks" class="section level2">
<h2>Cumulative incidence for competing risks</h2>
<ul>
<li>Non-parametric estimation of the cumulative incidence</li>
<li>Estimates the cumulative incidence of the event of interest</li>
<li>At any point in time the sum of the cumulative incidence of each event is equal to the total cumulative incidence of any event (not true in the cause-specific setting)</li>
<li>Gray’s test is a modified Chi-squared test used to compare 2 or more groups</li>
</ul>
</div>
<div id="example-melanoma-data-from-the-mass-package" class="section level2">
<h2>Example Melanoma data from the MASS package</h2>
<p>We use the <code>Melanoma</code> data from the <code>MASS</code> package to illustrate these concepts. It contains variables:</p>
<ul>
<li><code>time</code> survival time in days, possibly censored.</li>
<li><code>status</code> 1 died from melanoma, 2 alive, 3 dead from other causes.</li>
<li><code>sex</code> 1 = male, 0 = female.</li>
<li><code>age</code> age in years.</li>
<li><code>year</code> of operation.</li>
<li><code>thickness</code> tumor thickness in mm.</li>
<li><code>ulcer</code> 1 = presence, 0 = absence.</li>
</ul>
<pre class="r"><code>data(Melanoma, package = &quot;MASS&quot;)</code></pre>
</div>
<div id="cumulative-incidence-in-melanoma-data" class="section level2">
<h2>Cumulative incidence in Melanoma data</h2>
<p>Estimate the cumulative incidence in the context of competing risks using the <code>cuminc</code> function.</p>
<p><em>Note</em>: in the <code>Melanoma</code> data, censored patients are coded as <span class="math inline">\(2\)</span> for <code>status</code>, so we cannot use the <code>cencode</code> option default of <span class="math inline">\(0\)</span></p>
<pre class="r"><code>cuminc(Melanoma$time, Melanoma$status, cencode = 2)</code></pre>
<pre><code>## Estimates and Variances:
## $est
##           1000       2000       3000      4000      5000
## 1 1 0.12745714 0.23013963 0.30962017 0.3387175 0.3387175
## 1 3 0.03426709 0.05045644 0.05811143 0.1059471 0.1059471
## 
## $var
##             1000         2000         3000        4000        5000
## 1 1 0.0005481186 0.0009001172 0.0013789328 0.001690760 0.001690760
## 1 3 0.0001628354 0.0002451319 0.0002998642 0.001040155 0.001040155</code></pre>
</div>
<div id="plot-the-cumulative-incidence---base-r" class="section level2">
<h2>Plot the cumulative incidence - base R</h2>
<p>Generate a base <code>R</code> plot with all the defaults.</p>
<pre class="r"><code>ci_fit &lt;- 
  cuminc(
    ftime = Melanoma$time, 
    fstatus = Melanoma$status, 
    cencode = 2
    )</code></pre>
<pre class="r"><code>plot(ci_fit)</code></pre>
<p><img src="survival_analysis_in_r_tutorial_files/figure-html/unnamed-chunk-31-1.png" width="480" /></p>
<p>In the legend:</p>
<ul>
<li>The first number indicates the group, in this case there is only an overall estimate so it is <span class="math inline">\(1\)</span> for both</li>
<li>The second number indicates the event type, in this case the solid line is <span class="math inline">\(1\)</span> for death from melanoma and the dashed line is <span class="math inline">\(3\)</span> for death from other causes</li>
</ul>
</div>
<div id="plot-the-cumulative-incidence---ggcompetingrisks" class="section level2">
<h2>Plot the cumulative incidence - ggcompetingrisks</h2>
<p>We can also plot the cumulative incidence using the <code>ggscompetingrisks</code> function from the <code>survminer</code> package.</p>
<p>In this case we get a panel labeled according to the group, and a legend labeled event, indicating the type of event for each line.</p>
<p><em>Notes</em></p>
<ul>
<li>you can use the option <code>multiple_panels = FALSE</code> to have all groups plotted on a single panel</li>
<li>unlike base <code>R</code> the y-axis does not go to 1 by default, so you must change it manually</li>
</ul>
<pre class="r"><code>ggcompetingrisks(ci_fit)</code></pre>
<p><img src="survival_analysis_in_r_tutorial_files/figure-html/unnamed-chunk-32-1.png" width="480" /></p>
</div>
<div id="compare-cumulative-incidence-between-groups" class="section level2">
<h2>Compare cumulative incidence between groups</h2>
<p>In <code>cuminc</code> Gray’s test is used for between-group tests.</p>
<p>As an example, compare the <code>Melanoma</code> outcomes according to <code>ulcer</code>, the presence or absence of ulceration. The results of the tests can be found in <code>Tests</code>.</p>
<pre class="r"><code>ci_ulcer &lt;- 
  cuminc(
    ftime = Melanoma$time, 
    fstatus = Melanoma$status, 
    group = Melanoma$ulcer,
    cencode = 2
    )

ci_ulcer[[&quot;Tests&quot;]]</code></pre>
<pre><code>##        stat           pv df
## 1 26.120719 3.207240e-07  1
## 3  0.158662 6.903913e-01  1</code></pre>
</div>
<div id="plot-cumulative-incidence-according-to-group---ggcompetingrisks" class="section level2">
<h2>Plot cumulative incidence according to group - ggcompetingrisks</h2>
<pre class="r"><code>ggcompetingrisks(
  fit = ci_ulcer, 
  multiple_panels = FALSE,
  xlab = &quot;Days&quot;,
  ylab = &quot;Cumulative incidence of event&quot;,
  title = &quot;Death by ulceration&quot;,
  ylim = c(0, 1)
)</code></pre>
<p><img src="survival_analysis_in_r_tutorial_files/figure-html/unnamed-chunk-34-1.png" width="480" /></p>
</div>
<div id="plotting-cumulative-incidence-by-group---manually" class="section level2">
<h2>Plotting cumulative incidence by group - manually</h2>
<p><em>Note</em> I personally find the <code>ggcompetingrisks</code> function to be lacking in customization, especially compared to <code>ggsurvplot</code>. I typically do my own plotting, by first creating a tidy dataset of the <code>cuminc</code> fit results, and then plotting the results. See the source code for this presentation for details of the underlying code.</p>
<p><img src="survival_analysis_in_r_tutorial_files/figure-html/unnamed-chunk-35-1.png" width="480" /></p>
</div>
<div id="plotting-a-single-event-type---manually" class="section level2">
<h2>Plotting a single event type - manually</h2>
<p>Often only one of the event types will be of interest, though we still want to account for the competing event. In that case the event of interest can be plotted alone. Again, I do this manually by first creating a tidy dataset of the <code>cuminc</code> fit results, and then plotting the results. See the source code for this presentation for details of the underlying code.</p>
<p><img src="survival_analysis_in_r_tutorial_files/figure-html/unnamed-chunk-36-1.png" width="480" /></p>
</div>
<div id="add-the-numbers-at-risk-table" class="section level2">
<h2>Add the numbers at risk table</h2>
<p>You may want to add the numbers of risk table to a cumulative incidence plot, and there is no easy way to do this that I know of. See the source code for this presentation for one example</p>
<ol style="list-style-type: decimal">
<li>Get a plot from base <code>R</code>, <code>ggcompetingrisks</code>, or <code>ggplot</code></li>
<li>Get the number at risk table from a <code>ggsurvplot</code> using the <code>survfit</code> where all events count as a single composite endpoint
<ul>
<li>Force the axes to have the same limits and breaks and titles</li>
<li>Make sure the colors/linetypes match for the group labels</li>
<li>Try to get the fontsize to be the same</li>
</ul></li>
<li>Then combine the plot and the risktable. I use the <code>plot_grid</code> function from the <code>cowplot</code> package for this
<ul>
<li>I do NOT know how to change the “Number at risk” text size…</li>
</ul></li>
</ol>
<p><img src="survival_analysis_in_r_tutorial_files/figure-html/unnamed-chunk-37-1.png" width="480" /></p>
</div>
<div id="competing-risks-regression" class="section level2">
<h2>Competing risks regression</h2>
<p>Two approaches:</p>
<ol style="list-style-type: decimal">
<li>Cause-specific hazards
<ul>
<li>instantaneous rate of occurrence of the given type of event in subjects who are currently event‐free</li>
<li>estimated using Cox regression (<code>coxph</code> function)</li>
</ul></li>
<li>Subdistribution hazards
<ul>
<li>instantaneous rate of occurrence of the given type of event in subjects who have not yet experienced an event of that type</li>
<li>estimated using Fine-Gray regression (<code>crr</code> function)</li>
</ul></li>
</ol>
</div>
<div id="competing-risks-regression-in-melanoma-data---subdistribution-hazard-approach" class="section level2">
<h2>Competing risks regression in Melanoma data - subdistribution hazard approach</h2>
<p>Let’s say we’re interested in looking at the effect of age and sex on death from melanoma, with death from other causes as a competing event.</p>
<p>Notes:</p>
<ul>
<li><code>crr</code> requires specification of covariates as a matrix</li>
<li>If more than one event is of interest, you can request results for a different event by using the <code>failcode</code> option, by default results are returned for <code>failcode = 1</code></li>
</ul>
<pre class="r"><code>shr_fit &lt;- 
  crr(
    ftime = Melanoma$time,
    fstatus = Melanoma$status,
    cov1 = Melanoma[, c(&quot;sex&quot;, &quot;age&quot;)],
    cencode = 2
    )

shr_fit</code></pre>
<pre><code>## convergence:  TRUE 
## coefficients:
##     sex     age 
## 0.58840 0.01259 
## standard errors:
## [1] 0.271800 0.009301
## two-sided p-values:
##  sex  age 
## 0.03 0.18</code></pre>
<p>In the previous example, both <code>sex</code> and <code>age</code> were coded as numeric variables. The <code>crr</code> function can’t naturally handle character variables, and you will get an error, so if character variables are present we have to create dummy variables using <code>model.matrix</code></p>
<pre class="r"><code># Create an example character variable
chardat &lt;- 
  Melanoma %&gt;% 
  mutate(
    sex_char = ifelse(sex == 0, &quot;Male&quot;, &quot;Female&quot;)
  )

# Create dummy variables with model.matrix
# The [, -1] removes the intercept
covs1 &lt;- model.matrix(~ sex_char + age, data = chardat)[, -1]

# Now we can pass that to the cov1 argument, and it will work
crr(
  ftime = chardat$time,
  fstatus = chardat$status,
  cov1 = covs1,
  cencode = 2
  )</code></pre>
</div>
<div id="formatting-results-from-crr" class="section level2">
<h2>Formatting results from crr</h2>
<p>Output from <code>crr</code> is not supported by either <code>broom::tidy()</code> or <code>gtsummary::tbl_regression()</code> at this time. As an alternative, try the (not flexible, but better than nothing?) <code>mvcrrres</code> from my <code>ezfun</code> package</p>
<pre class="r"><code>ezfun::mvcrrres(shr_fit) %&gt;% 
  kable()</code></pre>
<table>
<thead>
<tr class="header">
<th></th>
<th align="left">HR (95% CI)</th>
<th align="left">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>sex</td>
<td align="left">1.8 (1.06, 3.07)</td>
<td align="left">0.03</td>
</tr>
<tr class="even">
<td>age</td>
<td align="left">1.01 (0.99, 1.03)</td>
<td align="left">0.18</td>
</tr>
</tbody>
</table>
</div>
<div id="competing-risks-regression-in-melanoma-data---cause-specific-hazard-approach" class="section level2">
<h2>Competing risks regression in Melanoma data - cause-specific hazard approach</h2>
<p>Censor all subjects who didn’t have the event of interest, in this case death from melanoma, and use <code>coxph</code> as before. So patients who died from other causes are now censored for the cause-specific hazard approach to competing risks.</p>
<p>Results can be formatted with <code>broom::tidy()</code> or <code>gtsummary::tbl_regression()</code></p>
<pre class="r"><code>chr_fit &lt;- 
  coxph(
    Surv(time, ifelse(status == 1, 1, 0)) ~ sex + age, 
    data = Melanoma
    )

broom::tidy(chr_fit, exp = TRUE) %&gt;% 
  kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
<th align="right">conf.low</th>
<th align="right">conf.high</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">sex</td>
<td align="right">1.818949</td>
<td align="right">0.2676386</td>
<td align="right">2.235323</td>
<td align="right">0.0253961</td>
<td align="right">1.0764804</td>
<td align="right">3.073513</td>
</tr>
<tr class="even">
<td align="left">age</td>
<td align="right">1.016679</td>
<td align="right">0.0086628</td>
<td align="right">1.909514</td>
<td align="right">0.0561958</td>
<td align="right">0.9995631</td>
<td align="right">1.034088</td>
</tr>
</tbody>
</table>
<pre class="r"><code>gtsummary::tbl_regression(chr_fit, exp = TRUE)</code></pre>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#tjxokapgnw .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  /* table.margin.left */
  margin-right: auto;
  /* table.margin.right */
  color: #333333;
  font-size: 16px;
  /* table.font.size */
  background-color: #FFFFFF;
  /* table.background.color */
  width: auto;
  /* table.width */
  border-top-style: solid;
  /* table.border.top.style */
  border-top-width: 2px;
  /* table.border.top.width */
  border-top-color: #A8A8A8;
  /* table.border.top.color */
  border-bottom-style: solid;
  /* table.border.bottom.style */
  border-bottom-width: 2px;
  /* table.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* table.border.bottom.color */
}

#tjxokapgnw .gt_heading {
  background-color: #FFFFFF;
  /* heading.background.color */
  border-bottom-color: #FFFFFF;
  /* table.background.color */
  border-left-style: hidden;
  /* heading.border.lr.style */
  border-left-width: 1px;
  /* heading.border.lr.width */
  border-left-color: #D3D3D3;
  /* heading.border.lr.color */
  border-right-style: hidden;
  /* heading.border.lr.style */
  border-right-width: 1px;
  /* heading.border.lr.width */
  border-right-color: #D3D3D3;
  /* heading.border.lr.color */
}

#tjxokapgnw .gt_title {
  color: #333333;
  font-size: 125%;
  /* heading.title.font.size */
  font-weight: initial;
  /* heading.title.font.weight */
  padding-top: 4px;
  /* heading.top.padding - not yet used */
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  /* table.background.color */
  border-bottom-width: 0;
}

#tjxokapgnw .gt_subtitle {
  color: #333333;
  font-size: 85%;
  /* heading.subtitle.font.size */
  font-weight: initial;
  /* heading.subtitle.font.weight */
  padding-top: 0;
  padding-bottom: 4px;
  /* heading.bottom.padding - not yet used */
  border-top-color: #FFFFFF;
  /* table.background.color */
  border-top-width: 0;
}

#tjxokapgnw .gt_bottom_border {
  border-bottom-style: solid;
  /* heading.border.bottom.style */
  border-bottom-width: 2px;
  /* heading.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* heading.border.bottom.color */
}

#tjxokapgnw .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  padding-top: 4px;
  padding-bottom: 4px;
}

#tjxokapgnw .gt_col_headings {
  border-top-style: solid;
  /* column_labels.border.top.style */
  border-top-width: 2px;
  /* column_labels.border.top.width */
  border-top-color: #D3D3D3;
  /* column_labels.border.top.color */
  border-bottom-style: solid;
  /* column_labels.border.bottom.style */
  border-bottom-width: 2px;
  /* column_labels.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* column_labels.border.bottom.color */
  border-left-style: none;
  /* column_labels.border.lr.style */
  border-left-width: 1px;
  /* column_labels.border.lr.width */
  border-left-color: #D3D3D3;
  /* column_labels.border.lr.color */
  border-right-style: none;
  /* column_labels.border.lr.style */
  border-right-width: 1px;
  /* column_labels.border.lr.width */
  border-right-color: #D3D3D3;
  /* column_labels.border.lr.color */
}

#tjxokapgnw .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  /* column_labels.background.color */
  font-size: 100%;
  /* column_labels.font.size */
  font-weight: initial;
  /* column_labels.font.weight */
  text-transform: inherit;
  /* column_labels.text_transform */
  vertical-align: middle;
  padding: 5px;
  margin: 10px;
  overflow-x: hidden;
}

#tjxokapgnw .gt_sep_right {
  border-right: 5px solid #FFFFFF;
}

#tjxokapgnw .gt_group_heading {
  padding: 8px;
  /* row_group.padding */
  color: #333333;
  background-color: #FFFFFF;
  /* row_group.background.color */
  font-size: 100%;
  /* row_group.font.size */
  font-weight: initial;
  /* row_group.font.weight */
  text-transform: inherit;
  /* row_group.text_transform */
  border-top-style: solid;
  /* row_group.border.top.style */
  border-top-width: 2px;
  /* row_group.border.top.width */
  border-top-color: #D3D3D3;
  /* row_group.border.top.color */
  border-bottom-style: solid;
  /* row_group.border.bottom.style */
  border-bottom-width: 2px;
  /* row_group.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* row_group.border.bottom.color */
  border-left-style: none;
  /* row_group.border.left.style */
  border-left-width: 1px;
  /* row_group.border.left.width */
  border-left-color: #D3D3D3;
  /* row_group.border.left.color */
  border-right-style: none;
  /* row_group.border.right.style */
  border-right-width: 1px;
  /* row_group.border.right.width */
  border-right-color: #D3D3D3;
  /* row_group.border.right.color */
  vertical-align: middle;
}

#tjxokapgnw .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  /* row_group.background.color */
  font-size: 100%;
  /* row_group.font.size */
  font-weight: initial;
  /* row_group.font.weight */
  border-top-style: solid;
  /* row_group.border.top.style */
  border-top-width: 2px;
  /* row_group.border.top.width */
  border-top-color: #D3D3D3;
  /* row_group.border.top.color */
  border-bottom-style: solid;
  /* row_group.border.bottom.style */
  border-bottom-width: 2px;
  /* row_group.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* row_group.border.bottom.color */
  vertical-align: middle;
}

#tjxokapgnw .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
  /* row.striping.background_color */
}

#tjxokapgnw .gt_from_md > :first-child {
  margin-top: 0;
}

#tjxokapgnw .gt_from_md > :last-child {
  margin-bottom: 0;
}

#tjxokapgnw .gt_row {
  padding-top: 8px;
  /* data_row.padding */
  padding-bottom: 8px;
  /* data_row.padding */
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  /* table_body.hlines.style */
  border-top-width: 1px;
  /* table_body.hlines.width */
  border-top-color: #D3D3D3;
  /* table_body.hlines.color */
  border-left-style: none;
  /* table_body.vlines.style */
  border-left-width: 1px;
  /* table_body.vlines.width */
  border-left-color: #D3D3D3;
  /* table_body.vlines.color */
  border-right-style: none;
  /* table_body.vlines.style */
  border-right-width: 1px;
  /* table_body.vlines.width */
  border-right-color: #D3D3D3;
  /* table_body.vlines.color */
  vertical-align: middle;
  overflow-x: hidden;
}

#tjxokapgnw .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  /* stub.background.color */
  font-weight: initial;
  /* stub.font.weight */
  text-transform: inherit;
  /* stub.text_transform */
  border-right-style: solid;
  /* stub.border.style */
  border-right-width: 2px;
  /* stub.border.width */
  border-right-color: #D3D3D3;
  /* stub.border.color */
  padding-left: 12px;
}

#tjxokapgnw .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  /* summary_row.background.color */
  text-transform: inherit;
  /* summary_row.text_transform */
  padding-top: 8px;
  /* summary_row.padding */
  padding-bottom: 8px;
  /* summary_row.padding */
  padding-left: 5px;
  padding-right: 5px;
}

#tjxokapgnw .gt_first_summary_row {
  padding-top: 8px;
  /* summary_row.padding */
  padding-bottom: 8px;
  /* summary_row.padding */
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  /* summary_row.border.style */
  border-top-width: 2px;
  /* summary_row.border.width */
  border-top-color: #D3D3D3;
  /* summary_row.border.color */
}

#tjxokapgnw .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  /* grand_summary_row.background.color */
  text-transform: inherit;
  /* grand_summary_row.text_transform */
  padding-top: 8px;
  /* grand_summary_row.padding */
  padding-bottom: 8px;
  /* grand_summary_row.padding */
  padding-left: 5px;
  padding-right: 5px;
}

#tjxokapgnw .gt_first_grand_summary_row {
  padding-top: 8px;
  /* grand_summary_row.padding */
  padding-bottom: 8px;
  /* grand_summary_row.padding */
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  /* grand_summary_row.border.style */
  border-top-width: 6px;
  /* grand_summary_row.border.width */
  border-top-color: #D3D3D3;
  /* grand_summary_row.border.color */
}

#tjxokapgnw .gt_table_body {
  border-top-style: solid;
  /* table_body.border.top.style */
  border-top-width: 2px;
  /* table_body.border.top.width */
  border-top-color: #D3D3D3;
  /* table_body.border.top.color */
  border-bottom-style: solid;
  /* table_body.border.bottom.style */
  border-bottom-width: 2px;
  /* table_body.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* table_body.border.bottom.color */
}

#tjxokapgnw .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  /* footnotes.background.color */
  border-bottom-style: none;
  /* footnotes.border.bottom.style */
  border-bottom-width: 2px;
  /* footnotes.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* footnotes.border.bottom.color */
  border-left-style: none;
  /* footnotes.border.lr.color */
  border-left-width: 2px;
  /* footnotes.border.lr.color */
  border-left-color: #D3D3D3;
  /* footnotes.border.lr.color */
  border-right-style: none;
  /* footnotes.border.lr.color */
  border-right-width: 2px;
  /* footnotes.border.lr.color */
  border-right-color: #D3D3D3;
  /* footnotes.border.lr.color */
}

#tjxokapgnw .gt_footnote {
  margin: 0px;
  font-size: 90%;
  /* footnotes.font.size */
  padding: 4px;
  /* footnotes.padding */
}

#tjxokapgnw .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  /* source_notes.background.color */
  border-bottom-style: none;
  /* source_notes.border.bottom.style */
  border-bottom-width: 2px;
  /* source_notes.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* source_notes.border.bottom.color */
  border-left-style: none;
  /* source_notes.border.lr.style */
  border-left-width: 2px;
  /* source_notes.border.lr.style */
  border-left-color: #D3D3D3;
  /* source_notes.border.lr.style */
  border-right-style: none;
  /* source_notes.border.lr.style */
  border-right-width: 2px;
  /* source_notes.border.lr.style */
  border-right-color: #D3D3D3;
  /* source_notes.border.lr.style */
}

#tjxokapgnw .gt_sourcenote {
  font-size: 90%;
  /* source_notes.font.size */
  padding: 4px;
  /* source_notes.padding */
}

#tjxokapgnw .gt_left {
  text-align: left;
}

#tjxokapgnw .gt_center {
  text-align: center;
}

#tjxokapgnw .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#tjxokapgnw .gt_font_normal {
  font-weight: normal;
}

#tjxokapgnw .gt_font_bold {
  font-weight: bold;
}

#tjxokapgnw .gt_font_italic {
  font-style: italic;
}

#tjxokapgnw .gt_super {
  font-size: 65%;
}

#tjxokapgnw .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="tjxokapgnw" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>HR</strong><sup class="gt_footnote_marks">1</sup></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>95% CI</strong><sup class="gt_footnote_marks">1</sup></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">sex</td>
      <td class="gt_row gt_center">1.82</td>
      <td class="gt_row gt_center">1.08, 3.07</td>
      <td class="gt_row gt_center">0.025</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">age</td>
      <td class="gt_row gt_center gt_striped">1.02</td>
      <td class="gt_row gt_center gt_striped">1.00, 1.03</td>
      <td class="gt_row gt_center gt_striped">0.056</td>
    </tr>
  </tbody>
  
  <tfoot>
    <tr class="gt_footnotes">
      <td colspan="4">
        <p class="gt_footnote">
          <sup class="gt_footnote_marks">
            <em>1</em>
          </sup>
           
          HR = Hazard Ratio, CI = Confidence Interval
          <br />
        </p>
      </td>
    </tr>
  </tfoot>
</table></div>
</div>
</div>
<div id="part-4-advanced-topics" class="section level1">
<h1>Part 4: Advanced Topics</h1>
<div id="what-weve-covered" class="section level2">
<h2>What we’ve covered</h2>
<ul>
<li>The basics of survival analysis including the Kaplan-Meier survival function and Cox regression</li>
<li>Landmark analysis and time-dependent covariates</li>
<li>Cumulative incidence and regression for competing risks analyses</li>
</ul>
</div>
<div id="whats-left" class="section level2">
<h2>What’s left?</h2>
<p>A variety of bits and pieces of things that may come up and be handy to know:</p>
<ol style="list-style-type: decimal">
<li>Assessing the proportional hazards assumption</li>
<li>Making a smooth survival plot based on <span class="math inline">\(x\)</span>-year survival according to a continuous covariate</li>
<li>Conditional survival</li>
</ol>
</div>
<div id="assessing-proportional-hazards" class="section level2">
<h2>Assessing proportional hazards</h2>
<p>One assumption of the Cox proportional hazards regression model is that the hazards are proportional at each point in time throughout follow-up. How can we check to see if our data meet this assumption?</p>
<p>Use the <code>cox.zph</code> function from the survival package. It results in two main things:</p>
<ol style="list-style-type: decimal">
<li>A hypothesis test of whether the effect of each covariate differs according to time, and a global test of all covariates at once.
<ul>
<li>This is done by testiung for an interaction effect between the covariate and log(time)</li>
<li>A significant p-value indicates that the proportional hazards assumption is violated</li>
</ul></li>
<li>Plots of the Schoenfeld residuals
<ul>
<li>Deviation from a zero-slope line is evidence that the proportional hazards assumption is violated</li>
</ul></li>
</ol>
<pre class="r"><code>mv_fit &lt;- coxph(Surv(time, status) ~ sex + age, data = lung)
cz &lt;- cox.zph(mv_fit)
print(cz)</code></pre>
<pre><code>##        chisq df    p
## sex    2.608  1 0.11
## age    0.209  1 0.65
## GLOBAL 2.771  2 0.25</code></pre>
<pre class="r"><code>plot(cz)</code></pre>
<p><img src="survival_analysis_in_r_tutorial_files/figure-html/unnamed-chunk-42-1.png" width="480" /><img src="survival_analysis_in_r_tutorial_files/figure-html/unnamed-chunk-42-2.png" width="480" /></p>
</div>
<div id="smooth-survival-plot---quantile-of-survival" class="section level2">
<h2>Smooth survival plot - quantile of survival</h2>
<p>Sometimes you will want to visualize a survival estimate according to a continuous variable. The <code>sm.survival</code> function from the <code>sm</code> package allows you to do this for a quantile of the distribution of survival data. The default quantile is <code>p = 0.5</code> for median survival.</p>
<pre class="r"><code>library(sm)

sm.options(
  list(
    xlab = &quot;Age (years)&quot;,
    ylab = &quot;Time to death (years)&quot;)
  )

sm.survival(
  x = lung$age,
  y = lung$time,
  status = lung$status,
  h = sd(lung$age) / nrow(lung)^(-1/4)
  )</code></pre>
<p><img src="survival_analysis_in_r_tutorial_files/figure-html/unnamed-chunk-43-1.png" width="480" /></p>
<ul>
<li>The x’s represent events</li>
<li>The o’s represent censoring</li>
<li>The line is a smoothed estimate of median survival according to age
<ul>
<li>In this case, too smooth!</li>
</ul></li>
</ul>
<p>The option <code>h</code> is the smoothing parameter. This should be related to the standard deviation of the continuous covariate, <span class="math inline">\(x\)</span>. Suggested to start with <span class="math inline">\(\frac{sd(x)}{n^{-1/4}}\)</span> then reduce by <span class="math inline">\(1/2\)</span>, <span class="math inline">\(1/4\)</span>, etc to get a good amount of smoothing. The previous plot was too smooth so let’s reduce it by <span class="math inline">\(1/4\)</span></p>
<pre class="r"><code>sm.survival(
  x = lung$age,
  y = lung$time,
  status = lung$status,
  h = (1/4) * sd(lung$age) / nrow(lung)^(-1/4)
  )</code></pre>
<p><img src="survival_analysis_in_r_tutorial_files/figure-html/unnamed-chunk-44-1.png" width="480" /></p>
</div>
<div id="conditional-survival" class="section level2">
<h2>Conditional survival</h2>
<p>Sometimes it is of interest to generate survival estimates among a group of patients who have already survived for some length of time.</p>
<p><span class="math display">\[S(y|x) = \frac{S(x + y)}{S(x)}\]</span></p>
<ul>
<li><span class="math inline">\(y\)</span>: number of additional survival years of interest</li>
<li><span class="math inline">\(x\)</span>: number of years a patient has already survived</li>
</ul>
<blockquote>
<p>Zabor, E., Gonen, M., Chapman, P., &amp; Panageas, K. (2013). Dynamic prognostication using conditional survival estimates. Cancer, 119(20), 3589-3592.</p>
</blockquote>
</div>
<div id="conditional-survival-estimates" class="section level2">
<h2>Conditional survival estimates</h2>
<p>The estimates are easy to generate with basic math on your own.</p>
<p>Alternatively, I have simple package in development called <code>condsurv</code> to generate estimates and plots related to conditional survival. We can use the <code>conditional_surv_est</code> function to get estimates and 95% confidence intervals. Let’s condition on survival to 6-months</p>
<pre class="r"><code>remotes::install_github(&quot;zabore/condsurv&quot;)</code></pre>
<pre class="r"><code>library(condsurv)

fit1 &lt;- survfit(Surv(time, status) ~ 1, data = lung)

prob_times &lt;- seq(365.25, 182.625 * 5, 182.625)

purrr::map_df(
  prob_times, 
  ~conditional_surv_est(
    basekm = fit1, 
    t1 = 182.625, 
    t2 = .x) 
  ) %&gt;% 
  mutate(months = round(prob_times / 30.4)) %&gt;% 
  select(months, everything()) %&gt;% 
  kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">months</th>
<th align="right">cs_est</th>
<th align="right">cs_lci</th>
<th align="right">cs_uci</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">12</td>
<td align="right">0.58</td>
<td align="right">0.49</td>
<td align="right">0.66</td>
</tr>
<tr class="even">
<td align="right">18</td>
<td align="right">0.36</td>
<td align="right">0.27</td>
<td align="right">0.45</td>
</tr>
<tr class="odd">
<td align="right">24</td>
<td align="right">0.16</td>
<td align="right">0.10</td>
<td align="right">0.25</td>
</tr>
<tr class="even">
<td align="right">30</td>
<td align="right">0.07</td>
<td align="right">0.02</td>
<td align="right">0.15</td>
</tr>
<tr class="odd">
<td align="right">Recall th</td>
<td align="right">at our in</td>
<td align="right">itial <span class="math inline">\(1\)</span></td>
<td align="right">-year survival estimate was 0.41. We see that for patients who have already survived 6-months this increases to 0.58.</td>
</tr>
</tbody>
</table>
</div>
<div id="conditional-survival-plots" class="section level2">
<h2>Conditional survival plots</h2>
<p>We can also visualize conditional survival data based on different lengths of time survived. The <code>condsurv::condKMggplot</code> function can help with this.</p>
<pre class="r"><code>cond_times &lt;- seq(0, 182.625 * 4, 182.625)

gg_conditional_surv(
  basekm = fit1, 
  at = cond_times,
  main = &quot;Conditional survival in lung data&quot;,
  xlab = &quot;Days&quot;
  ) +
  labs(color = &quot;Conditional time&quot;)</code></pre>
<p><img src="survival_analysis_in_r_tutorial_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
<p>The resulting plot has one survival curve for each time on which we condition. In this case the first line is the overall survival curve since it is conditioning on time 0.</p>
<pre class="r"><code>knit_exit()</code></pre>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
